import{_ as s,c as e,a,o as E}from"./app-6X7aTgdN.js";const i={};function A(r,n){return E(),e("div",null,n[0]||(n[0]=[a(`<h1 id="runc-容器生命周期流程图" tabindex="-1"><a class="header-anchor" href="#runc-容器生命周期流程图"><span>runc 容器生命周期流程图</span></a></h1><h2 id="_1-runc-容器创建总体流程" tabindex="-1"><a class="header-anchor" href="#_1-runc-容器创建总体流程"><span>1. runc 容器创建总体流程</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TD%0A%20%20%20%20A%5Brunc%20create%2Frun%5D%20--%3E%20B%5B%E8%A7%A3%E6%9E%90OCI%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20B%20--%3E%20C%5B%E5%88%9B%E5%BB%BAFactory%5D%0A%20%20%20%20C%20--%3E%20D%5B%E7%94%9F%E6%88%90libcontainer%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20D%20--%3E%20E%5B%E5%88%9B%E5%BB%BAContainer%E5%AE%9E%E4%BE%8B%5D%0A%20%20%20%20E%20--%3E%20F%5B%E5%90%AF%E5%8A%A8%E7%88%B6%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20F%20--%3E%20G%5Bnsexec.c%E5%BC%95%E5%AF%BC%5D%0A%20%20%20%20G%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20H%20--%3E%20I%5B%E8%AE%BE%E7%BD%AE%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%5D%0A%20%20%20%20I%20--%3E%20J%5B%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%5D%0A%20%20%20%20J%20--%3E%20K%5B%E5%BA%94%E7%94%A8%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%5D%0A%20%20%20%20K%20--%3E%20L%5B%E6%89%A7%E8%A1%8Cinit%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20L%20--%3E%20M%5B%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20M%20--%3E%20N%5B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E4%B8%AD%5D" id="mermaid-dgqxr0igz"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_2-runc-命令流程对比" tabindex="-1"><a class="header-anchor" href="#_2-runc-命令流程对比"><span>2. runc 命令流程对比</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20LR%0A%20%20%20%20subgraph%20CREATE%5B%22runc%20create%22%5D%0A%20%20%20%20%20%20%20%20A1%5Bcreate%E5%91%BD%E4%BB%A4%5D%20--%3E%20B1%5BstartContainer%5D%0A%20%20%20%20%20%20%20%20B1%20--%3E%20C1%5BCT_ACT_CREATE%5D%0A%20%20%20%20%20%20%20%20C1%20--%3E%20D1%5B%E5%AE%B9%E5%99%A8%E5%B7%B2%E5%88%9B%E5%BB%BA%E4%BD%86%E6%9C%AA%E5%90%AF%E5%8A%A8%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20START%5B%22runc%20start%22%5D%0A%20%20%20%20%20%20%20%20A2%5Bstart%E5%91%BD%E4%BB%A4%5D%20--%3E%20B2%5B%E5%8A%A0%E8%BD%BD%E7%8E%B0%E6%9C%89%E5%AE%B9%E5%99%A8%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20C2%5Bcontainer.Start%5D%0A%20%20%20%20%20%20%20%20C2%20--%3E%20D2%5B%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20RUN%5B%22runc%20run%22%5D%0A%20%20%20%20%20%20%20%20A3%5Brun%E5%91%BD%E4%BB%A4%5D%20--%3E%20B3%5BstartContainer%5D%0A%20%20%20%20%20%20%20%20B3%20--%3E%20C3%5BCT_ACT_RUN%5D%0A%20%20%20%20%20%20%20%20C3%20--%3E%20D3%5B%E5%88%9B%E5%BB%BA%E5%B9%B6%E7%AB%8B%E5%8D%B3%E5%90%AF%E5%8A%A8%5D%0A%20%20%20%20end" id="mermaid-lfc87u7wb"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_3-nsexec-c-三阶段引导过程" tabindex="-1"><a class="header-anchor" href="#_3-nsexec-c-三阶段引导过程"><span>3. nsexec.c 三阶段引导过程</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TD%0A%20%20%20%20A%5BStage%200%3A%20STAGE_PARENT%5D%20--%3E%20B%5BStage%201%3A%20STAGE_CHILD%5D%0A%20%20%20%20B%20--%3E%20C%5BStage%202%3A%20STAGE_INIT%5D%0A%20%20%20%20%0A%20%20%20%20subgraph%20STAGE0%5B%22Stage%200%20%E8%AF%A6%E7%BB%86%22%5D%0A%20%20%20%20%20%20%20%20A1%5B%E8%A7%A3%E6%9E%90netlink%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20%20%20%20%20A2%5B%E5%88%9B%E5%BB%BA%E5%AD%90%E8%BF%9B%E7%A8%8Bclone_parent%5D%0A%20%20%20%20%20%20%20%20A3%5B%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E6%98%A0%E5%B0%84%5D%0A%20%20%20%20%20%20%20%20A4%5B%E7%AE%A1%E7%90%86%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20STAGE1%5B%22Stage%201%20%E8%AF%A6%E7%BB%86%22%5D%0A%20%20%20%20%20%20%20%20B1%5B%E5%8A%A0%E5%85%A5%E6%8C%87%E5%AE%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4setns%5D%0A%20%20%20%20%20%20%20%20B2%5Bunshare%E6%96%B0%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20%20%20%20%20B3%5B%E5%88%9B%E5%BB%BAPID%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%AD%90%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20%20%20%20%20B4%5B%E5%8D%8F%E8%B0%83%E7%94%A8%E6%88%B7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E6%98%A0%E5%B0%84%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20STAGE2%5B%22Stage%202%20%E8%AF%A6%E7%BB%86%22%5D%0A%20%20%20%20%20%20%20%20C1%5B%E8%AE%BE%E7%BD%AE%E4%BC%9A%E8%AF%9DID%20setsid%5D%0A%20%20%20%20%20%20%20%20C2%5B%E5%88%87%E6%8D%A2%E5%88%B0%E5%AE%B9%E5%99%A8%E7%94%A8%E6%88%B7%2F%E7%BB%84%5D%0A%20%20%20%20%20%20%20%20C3%5B%E8%BF%94%E5%9B%9EGo%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9C%80%E7%BB%88%E8%AE%BE%E7%BD%AE%5D%0A%20%20%20%20end" id="mermaid-skqfjfpmz"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_4-命名空间创建顺序和依赖关系" tabindex="-1"><a class="header-anchor" href="#_4-命名空间创建顺序和依赖关系"><span>4. 命名空间创建顺序和依赖关系</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">命名空间创建顺序（关键在于User NS必须最先创建）:</span>
<span class="line"></span>
<span class="line">┌─────────────┐    ┌─────────────┐    ┌─────────────┐</span>
<span class="line">│ User NS     │───▶│ IPC NS      │───▶│ UTS NS      │</span>
<span class="line">│ (NEWUSER)   │    │ (NEWIPC)    │    │ (NEWUTS)    │</span>
<span class="line">│ 用户隔离    │    │ IPC隔离     │    │ 主机名隔离  │</span>
<span class="line">└─────────────┘    └─────────────┘    └─────────────┘</span>
<span class="line">       │                   │                   │</span>
<span class="line">       ▼                   ▼                   ▼</span>
<span class="line">┌─────────────┐    ┌─────────────┐    ┌─────────────┐</span>
<span class="line">│ Network NS  │    │ PID NS      │    │ Mount NS    │</span>
<span class="line">│ (NEWNET)    │    │ (NEWPID)    │    │ (NEWNS)     │</span>
<span class="line">│ 网络隔离    │    │ 进程隔离    │    │ 文件系统隔离│</span>
<span class="line">└─────────────┘    └─────────────┘    └─────────────┘</span>
<span class="line">       │                   │                   │</span>
<span class="line">       ▼                   ▼                   ▼</span>
<span class="line">┌─────────────┐    ┌─────────────┐</span>
<span class="line">│ Cgroup NS   │    │ Time NS     │</span>
<span class="line">│ (NEWCGROUP) │    │ (NEWTIME)   │</span>
<span class="line">│ Cgroup隔离  │    │ 时间隔离    │</span>
<span class="line">└─────────────┘    └─────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-进程通信和同步机制" tabindex="-1"><a class="header-anchor" href="#_5-进程通信和同步机制"><span>5. 进程通信和同步机制</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">父进程 (runc)          子进程 (init)         容器进程</span>
<span class="line">      │                     │                    │</span>
<span class="line">      │  initSockParent ◄──►│ initSockChild      │</span>
<span class="line">      │  ─────────────────── │                   │</span>
<span class="line">      │                     │                   │</span>
<span class="line">      │  syncSockParent ◄──►│ syncSockChild      │</span>
<span class="line">      │  ─────────────────── │                   │</span>
<span class="line">      │                     │                   │</span>
<span class="line">      │  logPipeParent  ◄───│ logPipeChild       │</span>
<span class="line">      │  ─────────────────── │                   │</span>
<span class="line">      │                     │                   │</span>
<span class="line">      │     FIFO通道     ◄──│────────────────────│</span>
<span class="line">      │  ─────────────────── │                   │</span>
<span class="line">      </span>
<span class="line">同步消息类型:</span>
<span class="line">- SYNC_USERMAP_PLS/ACK  (用户映射请求/确认)</span>
<span class="line">- SYNC_RECVPID_PLS/ACK  (PID发送请求/确认)</span>
<span class="line">- SYNC_GRANDCHILD       (孙进程就绪)</span>
<span class="line">- SYNC_CHILD_FINISH     (子进程完成)</span>
<span class="line">- SYNC_TIMEOFFSETS_*    (时间偏移设置)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-安全策略应用流程" tabindex="-1"><a class="header-anchor" href="#_6-安全策略应用流程"><span>6. 安全策略应用流程</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TD%0A%20%20%20%20A%5B%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%5D%20--%3E%20B%5B%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20B%20--%3E%20C%5B%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%5D%0A%20%20%20%20C%20--%3E%20D%5BCapabilities%E8%AE%BE%E7%BD%AE%5D%0A%20%20%20%20D%20--%3E%20E%5BSeccomp%E8%BF%87%E6%BB%A4%E5%99%A8%5D%0A%20%20%20%20E%20--%3E%20F%5BLSM%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8%5D%0A%20%20%20%20F%20--%3E%20G%5BNoNewPrivileges%5D%0A%20%20%20%20G%20--%3E%20H%5B%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%5D%0A%20%20%20%20H%20--%3E%20I%5B%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%5D%0A%20%20%20%20I%20--%3E%20J%5B%E6%89%A7%E8%A1%8C%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20%0A%20%20%20%20subgraph%20SECURITY%5B%22%E5%AE%89%E5%85%A8%E5%B1%82%E7%BA%A7%22%5D%0A%20%20%20%20%20%20%20%20B1%5B%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%9A%94%E7%A6%BB%20-%20%E7%AC%AC%E4%B8%80%E5%B1%82%5D%0A%20%20%20%20%20%20%20%20D1%5BCapabilities%20-%20%E7%AC%AC%E4%BA%8C%E5%B1%82%5D%0A%20%20%20%20%20%20%20%20E1%5BSeccomp%20-%20%E7%AC%AC%E4%B8%89%E5%B1%82%5D%0A%20%20%20%20%20%20%20%20F1%5BAppArmor%2FSELinux%20-%20%E7%AC%AC%E5%9B%9B%E5%B1%82%5D%0A%20%20%20%20%20%20%20%20I1%5BCgroups%E9%99%90%E5%88%B6%20-%20%E7%AC%AC%E4%BA%94%E5%B1%82%5D%0A%20%20%20%20end" id="mermaid-f6gpfcf9p"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_7-文件系统挂载和隔离流程" tabindex="-1"><a class="header-anchor" href="#_7-文件系统挂载和隔离流程"><span>7. 文件系统挂载和隔离流程</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌────────────────────────────────────────────────────────────┐</span>
<span class="line">│                      Rootfs 准备流程                       │</span>
<span class="line">├────────────────────────────────────────────────────────────┤</span>
<span class="line">│                                                           │</span>
<span class="line">│  1. Mount Namespace 创建                                  │</span>
<span class="line">│     └── unshare(CLONE_NEWNS)                             │</span>
<span class="line">│                                                           │</span>
<span class="line">│  2. 基础挂载点准备                                        │</span>
<span class="line">│     ├── /proc (proc文件系统)                             │</span>
<span class="line">│     ├── /sys (sysfs文件系统)                             │</span>
<span class="line">│     ├── /dev (devtmpfs或bind挂载)                        │</span>
<span class="line">│     └── /dev/pts (devpts伪终端)                          │</span>
<span class="line">│                                                           │</span>
<span class="line">│  3. 用户挂载点处理                                        │</span>
<span class="line">│     ├── bind挂载 (源目录绑定)                            │</span>
<span class="line">│     ├── tmpfs挂载 (内存文件系统)                         │</span>
<span class="line">│     └── 特殊文件系统                                      │</span>
<span class="line">│                                                           │</span>
<span class="line">│  4. 安全挂载选项                                          │</span>
<span class="line">│     ├── MS_NOEXEC (禁止执行)                             │</span>
<span class="line">│     ├── MS_NOSUID (禁止setuid)                           │</span>
<span class="line">│     ├── MS_NODEV (禁止设备文件)                          │</span>
<span class="line">│     └── 挂载传播控制                                      │</span>
<span class="line">│                                                           │</span>
<span class="line">│  5. pivot_root或chroot                                   │</span>
<span class="line">│     └── 切换根文件系统                                    │</span>
<span class="line">│                                                           │</span>
<span class="line">│  6. 路径安全处理                                          │</span>
<span class="line">│     ├── MaskedPaths (隐藏路径)                           │</span>
<span class="line">│     └── ReadonlyPaths (只读路径)                         │</span>
<span class="line">│                                                           │</span>
<span class="line">└────────────────────────────────────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-cgroups-资源管理架构" tabindex="-1"><a class="header-anchor" href="#_8-cgroups-资源管理架构"><span>8. Cgroups 资源管理架构</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TB%0A%20%20%20%20A%5BContainer%5D%20--%3E%20B%5BCgroup%20Manager%5D%0A%20%20%20%20B%20--%3E%20C%5BMemory%20Controller%5D%0A%20%20%20%20B%20--%3E%20D%5BCPU%20Controller%5D%0A%20%20%20%20B%20--%3E%20E%5BBlockIO%20Controller%5D%0A%20%20%20%20B%20--%3E%20F%5BDevice%20Controller%5D%0A%20%20%20%20B%20--%3E%20G%5BNetwork%20Controller%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20C1%5Bmemory.limit_in_bytes%5D%0A%20%20%20%20C%20--%3E%20C2%5Bmemory.oom_control%5D%0A%20%20%20%20C%20--%3E%20C3%5Bmemory.swappiness%5D%0A%20%20%20%20%0A%20%20%20%20D%20--%3E%20D1%5Bcpu.shares%5D%0A%20%20%20%20D%20--%3E%20D2%5Bcpu.cfs_quota_us%5D%0A%20%20%20%20D%20--%3E%20D3%5Bcpu.cfs_period_us%5D%0A%20%20%20%20D%20--%3E%20D4%5Bcpuset.cpus%5D%0A%20%20%20%20%0A%20%20%20%20E%20--%3E%20E1%5Bblkio.weight%5D%0A%20%20%20%20E%20--%3E%20E2%5Bblkio.throttle.read_bps_device%5D%0A%20%20%20%20E%20--%3E%20E3%5Bblkio.throttle.write_bps_device%5D%0A%20%20%20%20%0A%20%20%20%20F%20--%3E%20F1%5Bdevices.allow%5D%0A%20%20%20%20F%20--%3E%20F2%5Bdevices.deny%5D%0A%20%20%20%20%0A%20%20%20%20G%20--%3E%20G1%5Bnet_cls.classid%5D%0A%20%20%20%20G%20--%3E%20G2%5Bnet_prio.ifpriomap%5D" id="mermaid-wdbznm0bb"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_9-容器状态转换图" tabindex="-1"><a class="header-anchor" href="#_9-容器状态转换图"><span>9. 容器状态转换图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="stateDiagram-v2%0A%20%20%20%20%5B*%5D%20--%3E%20Creating%3A%20runc%20create%2Frun%0A%20%20%20%20Creating%20--%3E%20Created%3A%20%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F%0A%20%20%20%20Creating%20--%3E%20%5B*%5D%3A%20%E5%88%9B%E5%BB%BA%E5%A4%B1%E8%B4%A5%0A%20%20%20%20%0A%20%20%20%20Created%20--%3E%20Running%3A%20runc%20start%0A%20%20%20%20Created%20--%3E%20%5B*%5D%3A%20runc%20delete%0A%20%20%20%20%0A%20%20%20%20Running%20--%3E%20Paused%3A%20runc%20pause%0A%20%20%20%20Paused%20--%3E%20Running%3A%20runc%20resume%0A%20%20%20%20%0A%20%20%20%20Running%20--%3E%20Stopped%3A%20%E8%BF%9B%E7%A8%8B%E9%80%80%E5%87%BA%0A%20%20%20%20Paused%20--%3E%20Stopped%3A%20runc%20kill%0A%20%20%20%20%0A%20%20%20%20Stopped%20--%3E%20%5B*%5D%3A%20runc%20delete%0A%20%20%20%20%0A%20%20%20%20note%20right%20of%20Creating%0A%20%20%20%20%20%20%20%20-%20OCI%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90%0A%20%20%20%20%20%20%20%20-%20%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%88%9B%E5%BB%BA%0A%20%20%20%20%20%20%20%20-%20%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%0A%20%20%20%20end%20note%0A%20%20%20%20%0A%20%20%20%20note%20right%20of%20Running%0A%20%20%20%20%20%20%20%20-%20%E8%BF%9B%E7%A8%8B%E6%89%A7%E8%A1%8C%E4%B8%AD%0A%20%20%20%20%20%20%20%20-%20%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%0A%20%20%20%20%20%20%20%20-%20%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%0A%20%20%20%20end%20note" id="mermaid-3vd084kmg"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_10-runc-错误处理和清理流程" tabindex="-1"><a class="header-anchor" href="#_10-runc-错误处理和清理流程"><span>10. runc 错误处理和清理流程</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌─────────────────────────────────────────────────────────────┐</span>
<span class="line">│                    错误处理和清理机制                        │</span>
<span class="line">├─────────────────────────────────────────────────────────────┤</span>
<span class="line">│                                                            │</span>
<span class="line">│  创建阶段错误处理:                                          │</span>
<span class="line">│  ┌──────────────────────────────────────────────────────┐   │</span>
<span class="line">│  │  defer func() {                                     │   │</span>
<span class="line">│  │      if retErr != nil {                             │   │</span>
<span class="line">│  │          _ = p.terminate()        // 终止进程       │   │</span>
<span class="line">│  │          _ = p.manager.Destroy()  // 清理cgroup     │   │</span>
<span class="line">│  │          _ = p.intelRdtManager.Destroy() // 清理RDT │   │</span>
<span class="line">│  │      }                                              │   │</span>
<span class="line">│  │  }()                                                │   │</span>
<span class="line">│  └──────────────────────────────────────────────────────┘   │</span>
<span class="line">│                                                            │</span>
<span class="line">│  运行时错误检测:                                            │</span>
<span class="line">│  ┌──────────────────────────────────────────────────────┐   │</span>
<span class="line">│  │  - OOM检测和处理                                     │   │</span>
<span class="line">│  │  - 进程退出状态监控                                  │   │</span>
<span class="line">│  │  - 信号传播和处理                                    │   │</span>
<span class="line">│  │  - 僵尸进程清理                                      │   │</span>
<span class="line">│  │  - 文件描述符泄漏防护                                │   │</span>
<span class="line">│  └──────────────────────────────────────────────────────┘   │</span>
<span class="line">│                                                            │</span>
<span class="line">│  清理顺序:                                                 │</span>
<span class="line">│  1. 发送SIGKILL信号                                        │</span>
<span class="line">│  2. 等待进程终止                                           │</span>
<span class="line">│  3. 清理cgroup资源                                         │</span>
<span class="line">│  4. 清理Intel RDT资源                                      │</span>
<span class="line">│  5. 清理挂载点                                             │</span>
<span class="line">│  6. 清理状态文件                                           │</span>
<span class="line">│  7. 关闭通信通道                                           │</span>
<span class="line">│                                                            │</span>
<span class="line">└─────────────────────────────────────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-网络配置和管理流程" tabindex="-1"><a class="header-anchor" href="#_11-网络配置和管理流程"><span>11. 网络配置和管理流程</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TD%0A%20%20%20%20A%5B%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%5D%20--%3E%20B%5BNetwork%20Namespace%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20B%20--%3E%20C%5B%E7%BD%91%E7%BB%9C%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8%5D%0A%20%20%20%20C%20--%3E%20D%5BLoopback%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20C%20--%3E%20E%5B%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%5D%0A%20%20%20%20C%20--%3E%20F%5B%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20%0A%20%20%20%20D%20--%3E%20D1%5Blo%E6%8E%A5%E5%8F%A3%E5%90%AF%E5%8A%A8%5D%0A%20%20%20%20D%20--%3E%20D2%5B127.0.0.1%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20%0A%20%20%20%20E%20--%3E%20E1%5Bveth%20pair%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20E%20--%3E%20E2%5B%E6%8E%A5%E5%8F%A3%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%AE%B9%E5%99%A8NS%5D%0A%20%20%20%20E%20--%3E%20E3%5BIP%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20%0A%20%20%20%20F%20--%3E%20F1%5B%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%5D%0A%20%20%20%20F%20--%3E%20F2%5B%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%5D%0A%20%20%20%20F%20--%3E%20F3%5B%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%5D%0A%20%20%20%20%0A%20%20%20%20subgraph%20NETWORK%5B%22%E7%BD%91%E7%BB%9C%E9%9A%94%E7%A6%BB%E5%B1%82%E7%BA%A7%22%5D%0A%20%20%20%20%20%20%20%20G1%5B%E7%BD%91%E7%BB%9C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20%20%20%20%20G2%5B%E6%8E%A5%E5%8F%A3%E7%BA%A7%E5%88%AB%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20%20%20%20%20G3%5B%E8%B7%AF%E7%94%B1%E7%BA%A7%E5%88%AB%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20%20%20%20%20G4%5B%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20end" id="mermaid-cfagqwayt"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_12-系统调用使用时序图" tabindex="-1"><a class="header-anchor" href="#_12-系统调用使用时序图"><span>12. 系统调用使用时序图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="sequenceDiagram%0A%20%20%20%20participant%20P%20as%20Parent%20Process%0A%20%20%20%20participant%20C%20as%20Child%20Process%0A%20%20%20%20participant%20K%20as%20Linux%20Kernel%0A%20%20%20%20%0A%20%20%20%20P-%3E%3EK%3A%20clone(CLONE_NEWNS%7CCLONE_NEWPID%7C...)%0A%20%20%20%20K--%3E%3EP%3A%20child_pid%0A%20%20%20%20%0A%20%20%20%20P-%3E%3EC%3A%20%E5%8F%91%E9%80%81%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%0A%20%20%20%20C-%3E%3EK%3A%20setns(existing_ns_fd)%0A%20%20%20%20C-%3E%3EK%3A%20unshare(CLONE_NEWUSER)%0A%20%20%20%20C-%3E%3EK%3A%20prctl(PR_SET_NO_NEW_PRIVS)%0A%20%20%20%20%0A%20%20%20%20C-%3E%3EK%3A%20mount(&#39;%2Fproc&#39;%2C%20&#39;%2Fproc&#39;%2C%20&#39;proc&#39;%2C%20MS_NOEXEC%7CMS_NOSUID%7CMS_NODEV)%0A%20%20%20%20C-%3E%3EK%3A%20mount(&#39;%2Fsys&#39;%2C%20&#39;%2Fsys&#39;%2C%20&#39;sysfs&#39;%2C%20MS_NOEXEC%7CMS_NOSUID%7CMS_NODEV)%0A%20%20%20%20C-%3E%3EK%3A%20mount(&#39;%2Fdev&#39;%2C%20&#39;%2Fdev&#39;%2C%20&#39;devtmpfs&#39;%2C%200)%0A%20%20%20%20%0A%20%20%20%20C-%3E%3EK%3A%20pivot_root(&#39;%2Fcontainer%2Froot&#39;%2C%20&#39;%2Fcontainer%2Froot%2Fold&#39;)%0A%20%20%20%20C-%3E%3EK%3A%20umount(&#39;%2Fold&#39;)%0A%20%20%20%20%0A%20%20%20%20C-%3E%3EK%3A%20capset(%26header%2C%20%26data)%0A%20%20%20%20C-%3E%3EK%3A%20prctl(PR_SET_SECCOMP%2C%20SECCOMP_MODE_FILTER%2C%20%26prog)%0A%20%20%20%20%0A%20%20%20%20C-%3E%3EK%3A%20execve(&#39;%2Fcontainer%2Fbin%2Fapp&#39;%2C%20argv%2C%20envp)%0A%20%20%20%20K--%3E%3EC%3A%20%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C" id="mermaid-7mrqj522w"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_13-runc-create-调试追踪流程图" tabindex="-1"><a class="header-anchor" href="#_13-runc-create-调试追踪流程图"><span>13. runc create 调试追踪流程图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="sequenceDiagram%0A%20%20%20%20participant%20CLI%20as%20runc%20CLI%0A%20%20%20%20participant%20Factory%20as%20LinuxFactory%0A%20%20%20%20participant%20Container%20as%20Container%0A%20%20%20%20participant%20InitProcess%20as%20initProcess%0A%20%20%20%20participant%20NSExec%20as%20nsexec.c%0A%20%20%20%20participant%20Kernel%20as%20Linux%20Kernel%0A%20%20%20%20participant%20CgroupMgr%20as%20CgroupManager%0A%0A%20%20%20%20Note%20over%20CLI%3A%20runc%20create%20mycontainer%0A%20%20%20%20CLI-%3E%3EFactory%3A%20Create(id%3D&#39;mycontainer&#39;%2C%20config)%0A%20%20%20%20Note%20right%20of%20Factory%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%201%3A%20%E9%AA%8C%E8%AF%81%E5%AE%B9%E5%99%A8ID%E5%92%8C%E9%85%8D%E7%BD%AE%0A%20%20%20%20%0A%20%20%20%20Factory-%3E%3EFactory%3A%20validateConfig(config)%0A%20%20%20%20Factory-%3E%3EFactory%3A%20createContainerRoot(&#39;%2Frun%2Frunc%2Fmycontainer&#39;)%0A%20%20%20%20Factory-%3E%3EContainer%3A%20newContainer(id%2C%20config%2C%20factory)%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Container%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%202%3A%20%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%88%9D%E5%A7%8B%E5%8C%96%0A%20%20%20%20Container-%3E%3EContainer%3A%20loadState()%0A%20%20%20%20Container-%3E%3ECgroupMgr%3A%20NewManager(config.Cgroups)%0A%20%20%20%20%0A%20%20%20%20CLI-%3E%3EContainer%3A%20Start(process)%0A%20%20%20%20Note%20right%20of%20Container%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%203%3A%20%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E5%87%86%E5%A4%87%0A%20%20%20%20%0A%20%20%20%20Container-%3E%3EInitProcess%3A%20newInitProcess(config%2C%20factory%2C%20pipe)%0A%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20createPipes()%20%0A%20%20%20%20Note%20right%20of%20InitProcess%3A%20%E5%88%9B%E5%BB%BA%E9%80%9A%E4%BF%A1%E7%AE%A1%E9%81%93%3A%20initSock%2C%20syncSock%2C%20logPipe%0A%20%20%20%20%0A%20%20%20%20Container-%3E%3EInitProcess%3A%20start()%0A%20%20%20%20Note%20over%20InitProcess%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%204%3A%20%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%87%86%E5%A4%87%0A%20%20%20%20%0A%20%20%20%20InitProcess-%3E%3EKernel%3A%20clone(CLONE_PARENT%20%7C%20SIGCHLD)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_clone%0A%20%20%20%20Kernel--%3E%3EInitProcess%3A%20child_pid%0A%20%20%20%20%0A%20%20%20%20par%20%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%88%86%E6%94%AF%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20parent.start()%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3ECgroupMgr%3A%20Apply(child_pid)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%205%3A%20Cgroup%E8%B5%84%E6%BA%90%E5%BA%94%E7%94%A8%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3EKernel%3A%20write%20cgroup.procs%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20sendConfig(initSock)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20InitProcess%3A%20%E5%8F%91%E9%80%81OCI%E9%85%8D%E7%BD%AE%E5%88%B0%E5%AD%90%E8%BF%9B%E7%A8%8B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20waitForSync(SYNC_USERMAP_PLS)%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EKernel%3A%20write%20%2Fproc%2Fchild_pid%2Fuid_map%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EKernel%3A%20write%20%2Fproc%2Fchild_pid%2Fgid_map%0A%20%20%20%20%20%20%20%20Note%20right%20of%20Kernel%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%206%3A%20%E7%94%A8%E6%88%B7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E6%98%A0%E5%B0%84%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20sendSync(SYNC_USERMAP_ACK)%0A%20%20%20%20and%20%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%88%86%E6%94%AF%20(nsexec.c)%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20nsexec_main()%0A%20%20%20%20%20%20%20%20Note%20over%20NSExec%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%207%3A%20C%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20receiveConfig(initSock)%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20stage_child_func()%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20setns(config.namespaces)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_setns%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20unshare(CLONE_NEWUSER)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_unshare%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20sendSync(SYNC_USERMAP_PLS)%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20waitForSync(SYNC_USERMAP_ACK)%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20clone(CLONE_PARENT%20%7C%20child_flags)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20Kernel%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%208%3A%20%E5%AD%99%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA%20(PID%3D1)%0A%20%20%20%20%20%20%20%20Kernel--%3E%3ENSExec%3A%20grandchild_pid%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20stage_init_func()%0A%20%20%20%20%20%20%20%20Note%20over%20NSExec%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%209%3A%20%E6%9C%80%E7%BB%88%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20setsid()%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20setuid(config.uid)%0A%20%20%20%20%20%20%20%20NSExec-%3E%3EKernel%3A%20setgid(config.gid)%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20NSExec-%3E%3ENSExec%3A%20return_to_go_runtime()%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Note%20over%20InitProcess%2CNSExec%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%2010%3A%20%E5%9B%9E%E5%88%B0Go%E8%BF%90%E8%A1%8C%E6%97%B6%0A%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20finalizeContainer()%0A%20%20%20%20InitProcess-%3E%3EKernel%3A%20%E5%85%B3%E9%97%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%0A%20%20%20%20%0A%20%20%20%20Container-%3E%3EContainer%3A%20updateState(Created)%0A%20%20%20%20Container-%3E%3EContainer%3A%20saveState()%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CLI%3A%20%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90%EF%BC%8C%E7%8A%B6%E6%80%81%3A%20Created" id="mermaid-znt8asd5v"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_14-runc-start-调试追踪流程图" tabindex="-1"><a class="header-anchor" href="#_14-runc-start-调试追踪流程图"><span>14. runc start 调试追踪流程图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="sequenceDiagram%0A%20%20%20%20participant%20CLI%20as%20runc%20CLI%0A%20%20%20%20participant%20Container%20as%20Container%0A%20%20%20%20participant%20Process%20as%20execProcess%0A%20%20%20%20participant%20InitProcess%20as%20initProcess%0A%20%20%20%20participant%20Kernel%20as%20Linux%20Kernel%0A%20%20%20%20participant%20App%20as%20%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%0A%0A%20%20%20%20Note%20over%20CLI%3A%20runc%20start%20mycontainer%0A%20%20%20%20CLI-%3E%3EContainer%3A%20loadContainer(&#39;mycontainer&#39;)%0A%20%20%20%20Container-%3E%3EContainer%3A%20loadState()%0A%20%20%20%20Note%20right%20of%20Container%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%201%3A%20%E5%8A%A0%E8%BD%BD%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81%0A%20%20%20%20%0A%20%20%20%20Container-%3E%3EContainer%3A%20currentStatus()%0A%20%20%20%20alt%20%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5%E5%A4%B1%E8%B4%A5%0A%20%20%20%20%20%20%20%20Container--%3E%3ECLI%3A%20ErrNotCreated%0A%20%20%20%20else%20%E7%8A%B6%E6%80%81%E4%B8%BA%20Created%0A%20%20%20%20%20%20%20%20Container-%3E%3EInitProcess%3A%20start()%0A%20%20%20%20%20%20%20%20Note%20over%20InitProcess%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%202%3A%20%E5%90%AF%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%9B%E7%A8%8B%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20InitProcess-%3E%3EInitProcess%3A%20signal(FIFO)%0A%20%20%20%20Note%20right%20of%20InitProcess%3A%20%E9%80%9A%E8%BF%87FIFO%E4%BF%A1%E5%8F%B7%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B%0A%20%20%20%20%0A%20%20%20%20InitProcess-%3E%3EKernel%3A%20write(exec_fifo_fd%2C%20&#39;0&#39;)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_write%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Process%3A%20%E5%AE%B9%E5%99%A8%E5%86%85%E8%BF%9B%E7%A8%8B%E8%A2%AB%E5%94%A4%E9%86%92%0A%20%20%20%20Process-%3E%3EProcess%3A%20%E8%AF%BB%E5%8F%96FIFO%E4%BF%A1%E5%8F%B7%0A%20%20%20%20Process-%3E%3EKernel%3A%20close(exec_fifo_fd)%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EProcess%3A%20setupMounts()%0A%20%20%20%20Note%20right%20of%20Process%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%203%3A%20%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%0A%20%20%20%20%0A%20%20%20%20loop%20%E5%A4%84%E7%90%86%E6%AF%8F%E4%B8%AA%E6%8C%82%E8%BD%BD%E7%82%B9%0A%20%20%20%20%20%20%20%20Process-%3E%3EKernel%3A%20mount(source%2C%20target%2C%20fstype%2C%20flags%2C%20data)%0A%20%20%20%20%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_mount%0A%20%20%20%20%20%20%20%20Process-%3E%3EProcess%3A%20validateMountTarget()%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EProcess%3A%20applySecurityProfile()%0A%20%20%20%20Note%20over%20Process%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%204%3A%20%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EKernel%3A%20prctl(PR_SET_NO_NEW_PRIVS%2C%201)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%A6%81%E7%94%A8%E6%96%B0%E6%9D%83%E9%99%90%E8%8E%B7%E5%8F%96%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EProcess%3A%20setupCapabilities()%0A%20%20%20%20Process-%3E%3EKernel%3A%20capset(%26header%2C%20%26data)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_capset%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EProcess%3A%20setupSeccomp()%0A%20%20%20%20Process-%3E%3EKernel%3A%20prctl(PR_SET_SECCOMP%2C%20SECCOMP_MODE_FILTER%2C%20%26prog)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_prctl%20(seccomp)%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EProcess%3A%20applyAppArmor%2FSELinux()%0A%20%20%20%20Note%20right%20of%20Process%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%205%3A%20LSM%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8%0A%20%20%20%20%0A%20%20%20%20Process-%3E%3EKernel%3A%20execve(container_binary%2C%20args%2C%20env)%0A%20%20%20%20Note%20right%20of%20Kernel%3A%20%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%BF%BD%E8%B8%AA%3A%20SYS_execve%0A%20%20%20%20%0A%20%20%20%20Kernel-%3E%3EApp%3A%20%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%0A%20%20%20%20Note%20over%20App%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%206%3A%20%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E8%BF%90%E8%A1%8C%0A%20%20%20%20%0A%20%20%20%20Container-%3E%3EContainer%3A%20updateState(Running)%0A%20%20%20%20Container-%3E%3EContainer%3A%20saveState()%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CLI%3A%20%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90%EF%BC%8C%E7%8A%B6%E6%80%81%3A%20Running" id="mermaid-2evpyu5iu"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_15-命名空间设置详细调试流程图" tabindex="-1"><a class="header-anchor" href="#_15-命名空间设置详细调试流程图"><span>15. 命名空间设置详细调试流程图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="graph%20TD%0A%20%20%20%20A%5Bnsexec.c%20%E5%85%A5%E5%8F%A3%5D%20--%3E%20B%5B%E8%A7%A3%E6%9E%90%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20B%20--%3E%20C%7B%E7%94%A8%E6%88%B7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%BC%98%E5%85%88%7D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%7C%E6%98%AF%7C%20D%5Bunshare%20CLONE_NEWUSER%5D%0A%20%20%20%20C%20--%3E%7C%E5%90%A6%7C%20E%5B%E6%A3%80%E6%9F%A5%E7%8E%B0%E6%9C%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20%0A%20%20%20%20D%20--%3E%20F%5B%E7%AD%89%E5%BE%85%E7%88%B6%E8%BF%9B%E7%A8%8B%E8%AE%BE%E7%BD%AE%E6%98%A0%E5%B0%84%5D%0A%20%20%20%20F%20--%3E%20G%5B%E6%8E%A5%E6%94%B6%E6%98%A0%E5%B0%84%E5%AE%8C%E6%88%90%E7%A1%AE%E8%AE%A4%5D%0A%20%20%20%20G%20--%3E%20H%5Bsetns%20%E5%8A%A0%E5%85%A5%E7%8E%B0%E6%9C%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20%0A%20%20%20%20E%20--%3E%20H%0A%20%20%20%20H%20--%3E%20I%5Bunshare%20%E5%88%9B%E5%BB%BA%E6%96%B0%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20%0A%20%20%20%20subgraph%20DEBUG%5B%22%E8%B0%83%E8%AF%95%E8%BF%BD%E8%B8%AA%E7%82%B9%22%5D%0A%20%20%20%20%20%20%20%20T1%5B%22strace%3A%20unshare%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%22%5D%0A%20%20%20%20%20%20%20%20T2%5B%22%2Fproc%2Fpid%2Fns%2F%20%E6%96%87%E4%BB%B6%E6%A3%80%E6%9F%A5%22%5D%0A%20%20%20%20%20%20%20%20T3%5B%22%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4inode%E5%8F%98%E5%8C%96%22%5D%0A%20%20%20%20%20%20%20%20T4%5B%22%E6%9D%83%E9%99%90%E6%98%A0%E5%B0%84%E9%AA%8C%E8%AF%81%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20I%20--%3E%20J%7B%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%7D%0A%20%20%20%20%0A%20%20%20%20J%20--%3E%7CPID%7C%20K%5B%E5%88%9B%E5%BB%BAPID%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20J%20--%3E%7CNET%7C%20L%5B%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20J%20--%3E%7CMNT%7C%20M%5B%E5%88%9B%E5%BB%BA%E6%8C%82%E8%BD%BD%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20J%20--%3E%7CIPC%7C%20N%5B%E5%88%9B%E5%BB%BAIPC%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20J%20--%3E%7CUTS%7C%20O%5B%E5%88%9B%E5%BB%BAUTS%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20J%20--%3E%7CCGROUP%7C%20P%5B%E5%88%9B%E5%BB%BACgroup%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%5D%0A%20%20%20%20%0A%20%20%20%20K%20--%3E%20K1%5Bclone%20with%20CLONE_NEWPID%5D%0A%20%20%20%20K1%20--%3E%20K2%5B%E6%96%B0%E8%BF%9B%E7%A8%8BPID%3D1%5D%0A%20%20%20%20%0A%20%20%20%20L%20--%3E%20L1%5B%E7%BD%91%E7%BB%9C%E6%A0%88%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20L1%20--%3E%20L2%5Bloopback%E6%8E%A5%E5%8F%A3%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20%0A%20%20%20%20M%20--%3E%20M1%5B%E6%8C%82%E8%BD%BD%E8%A1%A8%E7%A7%81%E6%9C%89%E5%8C%96%5D%0A%20%20%20%20M1%20--%3E%20M2%5Bpivot_root%E5%87%86%E5%A4%87%5D%0A%20%20%20%20%0A%20%20%20%20N%20--%3E%20N1%5BIPC%E8%B5%84%E6%BA%90%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20O%20--%3E%20O1%5B%E4%B8%BB%E6%9C%BA%E5%90%8D%2F%E5%9F%9F%E5%90%8D%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20P%20--%3E%20P1%5BCgroup%E8%A7%86%E5%9B%BE%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20%0A%20%20%20%20K2%20--%3E%20Q%5B%E5%90%8C%E6%AD%A5%E7%88%B6%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20L2%20--%3E%20Q%0A%20%20%20%20M2%20--%3E%20Q%0A%20%20%20%20N1%20--%3E%20Q%0A%20%20%20%20O1%20--%3E%20Q%0A%20%20%20%20P1%20--%3E%20Q%0A%20%20%20%20%0A%20%20%20%20Q%20--%3E%20R%5B%E8%BF%94%E5%9B%9EGo%E8%BF%90%E8%A1%8C%E6%97%B6%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23f9f%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20%20%20style%20T1%20fill%3A%23ff9%2Cstroke%3A%23333%2Cstroke-width%3A1px%0A%20%20%20%20style%20T2%20fill%3A%23ff9%2Cstroke%3A%23333%2Cstroke-width%3A1px%0A%20%20%20%20style%20T3%20fill%3A%23ff9%2Cstroke%3A%23333%2Cstroke-width%3A1px%0A%20%20%20%20style%20T4%20fill%3A%23ff9%2Cstroke%3A%23333%2Cstroke-width%3A1px" id="mermaid-yxg72e7ef"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_16-cgroup资源管理调试流程图" tabindex="-1"><a class="header-anchor" href="#_16-cgroup资源管理调试流程图"><span>16. Cgroup资源管理调试流程图</span></a></h2><div class="mermaid-wrapper"><div class="mermaid-container" data-mermaid-code="sequenceDiagram%0A%20%20%20%20participant%20CgroupMgr%20as%20CgroupManager%0A%20%20%20%20participant%20CgroupFS%20as%20CgroupFS%0A%20%20%20%20participant%20Kernel%20as%20Linux%20Kernel%0A%20%20%20%20participant%20Process%20as%20Container%20Process%0A%0A%20%20%20%20Note%20over%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%201%3A%20Cgroup%E7%AE%A1%E7%90%86%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%0A%20%20%20%20CgroupMgr-%3E%3ECgroupMgr%3A%20detectCgroupVersion()%0A%20%20%20%20%0A%20%20%20%20alt%20Cgroup%20v1%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20%2Fsys%2Ffs%2Fcgroup%2Fmemory%2F%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20%2Fsys%2Ffs%2Fcgroup%2Fcpu%2F%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20%2Fsys%2Ffs%2Fcgroup%2Fblkio%2F%0A%20%20%20%20else%20Cgroup%20v2%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20%2Fsys%2Ffs%2Fcgroup%2F%20(unified)%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%202%3A%20%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8Cgroup%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20mkdir%20%2Fsys%2Ffs%2Fcgroup%2Fmemory%2Fdocker%2Fcontainer_id%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20mkdir%20%2Fsys%2Ffs%2Fcgroup%2Fcpu%2Fdocker%2Fcontainer_id%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%203%3A%20%E5%BA%94%E7%94%A8%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20echo%20134217728%20%3E%20memory.limit_in_bytes%0A%20%20%20%20Note%20right%20of%20CgroupFS%3A%20%E5%86%85%E5%AD%98%E9%99%90%E5%88%B6%3A%20128MB%0A%20%20%20%20%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20echo%20512%20%3E%20cpu.shares%0A%20%20%20%20Note%20right%20of%20CgroupFS%3A%20CPU%E6%9D%83%E9%87%8D%E8%AE%BE%E7%BD%AE%0A%20%20%20%20%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20echo%2050000%20%3E%20cpu.cfs_quota_us%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20echo%20100000%20%3E%20cpu.cfs_period_us%0A%20%20%20%20Note%20right%20of%20CgroupFS%3A%20CPU%E9%85%8D%E9%A2%9D%3A%2050%25%20CPU%E6%97%B6%E9%97%B4%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%204%3A%20%E8%BF%9B%E7%A8%8B%E5%8A%A0%E5%85%A5Cgroup%0A%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20echo%20pid%20%3E%20cgroup.procs%0A%20%20%20%20Note%20right%20of%20CgroupFS%3A%20%E5%B0%86%E8%BF%9B%E7%A8%8BPID%E5%86%99%E5%85%A5Cgroup%0A%20%20%20%20%0A%20%20%20%20CgroupFS-%3E%3EKernel%3A%20%E9%80%9A%E7%9F%A5%E5%86%85%E6%A0%B8%E5%BA%94%E7%94%A8%E9%99%90%E5%88%B6%0A%20%20%20%20Kernel-%3E%3EProcess%3A%20%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%94%9F%E6%95%88%0A%20%20%20%20%0A%20%20%20%20Note%20over%20CgroupMgr%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%205%3A%20%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%0A%20%20%20%20loop%20%E7%9B%91%E6%8E%A7%E5%BE%AA%E7%8E%AF%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20cat%20memory.usage_in_bytes%0A%20%20%20%20%20%20%20%20CgroupFS--%3E%3ECgroupMgr%3A%20%E5%BD%93%E5%89%8D%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%87%8F%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20CgroupMgr-%3E%3ECgroupFS%3A%20cat%20cpu.stat%0A%20%20%20%20%20%20%20%20CgroupFS--%3E%3ECgroupMgr%3A%20CPU%E4%BD%BF%E7%94%A8%E7%BB%9F%E8%AE%A1%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E8%B6%85%E9%99%90%0A%20%20%20%20%20%20%20%20%20%20%20%20Kernel-%3E%3EProcess%3A%20OOM%20Kill%E4%BF%A1%E5%8F%B7%0A%20%20%20%20%20%20%20%20%20%20%20%20Note%20right%20of%20Process%3A%20%E8%B0%83%E8%AF%95%E7%82%B9%206%3A%20OOM%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end" id="mermaid-m5oha6idk"><div class="mermaid-loading">Loading diagram...</div></div></div><h2 id="_17-系统调用级别调试命令参考" tabindex="-1"><a class="header-anchor" href="#_17-系统调用级别调试命令参考"><span>17. 系统调用级别调试命令参考</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 调试点追踪命令集合</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 1. 追踪容器创建的系统调用</span></span>
<span class="line"><span class="token function">strace</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>clone,unshare,setns,mount,pivot_root,capset,prctl,execve <span class="token punctuation">\\</span></span>
<span class="line">  runc create mycontainer</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 监控命名空间变化</span></span>
<span class="line"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">&#39;ls -la /proc/$(pgrep -f &#39;</span>runc.*mycontainer<span class="token string">&#39;)/ns/&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 追踪Cgroup文件系统操作</span></span>
<span class="line">inotifywait <span class="token parameter variable">-m</span> <span class="token parameter variable">-r</span> /sys/fs/cgroup/ <span class="token parameter variable">--format</span> <span class="token string">&#39;%w%f %e&#39;</span> <span class="token operator">|</span> <span class="token function">grep</span> mycontainer</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 监控容器进程的能力集变化</span></span>
<span class="line"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">&#39;grep Cap /proc/$(pgrep -f &#39;</span>container-app<span class="token string">&#39;)/status&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5. 追踪网络命名空间操作</span></span>
<span class="line"><span class="token function">ip</span> netns monitor</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 6. 实时查看容器资源使用</span></span>
<span class="line"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">&#39;cat /sys/fs/cgroup/memory/docker/mycontainer/memory.usage_in_bytes</span>
<span class="line">              cat /sys/fs/cgroup/cpu/docker/mycontainer/cpuacct.usage&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 7. 追踪seccomp过滤器应用</span></span>
<span class="line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> seccomp</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 8. 调试挂载操作</span></span>
<span class="line"><span class="token function">cat</span> /proc/mounts <span class="token operator">|</span> <span class="token function">grep</span> mycontainer</span>
<span class="line">findmnt <span class="token parameter variable">--tree</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 9. 验证用户命名空间映射</span></span>
<span class="line"><span class="token function">cat</span> /proc/<span class="token variable"><span class="token variable">$(</span>pgrep <span class="token parameter variable">-f</span> mycontainer<span class="token variable">)</span></span>/uid_map</span>
<span class="line"><span class="token function">cat</span> /proc/<span class="token variable"><span class="token variable">$(</span>pgrep <span class="token parameter variable">-f</span> mycontainer<span class="token variable">)</span></span>/gid_map</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 10. 追踪进程间通信</span></span>
<span class="line"><span class="token function">lsof</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">$(</span>pgrep <span class="token parameter variable">-f</span> <span class="token string">&#39;runc.*mycontainer&#39;</span><span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">grep</span> pipe</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些图表详细展示了runc容器运行时的各个关键流程，从高层架构到具体实现细节，特别是添加了系统调用级别的调试追踪点，帮助理解runc是如何协调Linux内核的各种特性来实现安全、隔离的容器环境。</p>`,36)]))}const c=s(i,[["render",A]]),B=JSON.parse('{"path":"/blogs/cloud-base/runc-container-lifecycle-diagrams.html","title":"runc 容器生命周期流程图","lang":"en-US","frontmatter":{"title":"runc 容器生命周期流程图","date":"2024-01-20T00:00:00.000Z","tags":["runc","云原生","流程图"],"categories":["cloud-base"],"sidebar":"auto","description":"通过详细的流程图和架构图展示runc容器生命周期的各个阶段，包括创建、启动、运行等关键流程"},"headers":[{"level":2,"title":"1. runc 容器创建总体流程","slug":"_1-runc-容器创建总体流程","link":"#_1-runc-容器创建总体流程","children":[]},{"level":2,"title":"2. runc 命令流程对比","slug":"_2-runc-命令流程对比","link":"#_2-runc-命令流程对比","children":[]},{"level":2,"title":"3. nsexec.c 三阶段引导过程","slug":"_3-nsexec-c-三阶段引导过程","link":"#_3-nsexec-c-三阶段引导过程","children":[]},{"level":2,"title":"4. 命名空间创建顺序和依赖关系","slug":"_4-命名空间创建顺序和依赖关系","link":"#_4-命名空间创建顺序和依赖关系","children":[]},{"level":2,"title":"5. 进程通信和同步机制","slug":"_5-进程通信和同步机制","link":"#_5-进程通信和同步机制","children":[]},{"level":2,"title":"6. 安全策略应用流程","slug":"_6-安全策略应用流程","link":"#_6-安全策略应用流程","children":[]},{"level":2,"title":"7. 文件系统挂载和隔离流程","slug":"_7-文件系统挂载和隔离流程","link":"#_7-文件系统挂载和隔离流程","children":[]},{"level":2,"title":"8. Cgroups 资源管理架构","slug":"_8-cgroups-资源管理架构","link":"#_8-cgroups-资源管理架构","children":[]},{"level":2,"title":"9. 容器状态转换图","slug":"_9-容器状态转换图","link":"#_9-容器状态转换图","children":[]},{"level":2,"title":"10. runc 错误处理和清理流程","slug":"_10-runc-错误处理和清理流程","link":"#_10-runc-错误处理和清理流程","children":[]},{"level":2,"title":"11. 网络配置和管理流程","slug":"_11-网络配置和管理流程","link":"#_11-网络配置和管理流程","children":[]},{"level":2,"title":"12. 系统调用使用时序图","slug":"_12-系统调用使用时序图","link":"#_12-系统调用使用时序图","children":[]},{"level":2,"title":"13. runc create 调试追踪流程图","slug":"_13-runc-create-调试追踪流程图","link":"#_13-runc-create-调试追踪流程图","children":[]},{"level":2,"title":"14. runc start 调试追踪流程图","slug":"_14-runc-start-调试追踪流程图","link":"#_14-runc-start-调试追踪流程图","children":[]},{"level":2,"title":"15. 命名空间设置详细调试流程图","slug":"_15-命名空间设置详细调试流程图","link":"#_15-命名空间设置详细调试流程图","children":[]},{"level":2,"title":"16. Cgroup资源管理调试流程图","slug":"_16-cgroup资源管理调试流程图","link":"#_16-cgroup资源管理调试流程图","children":[]},{"level":2,"title":"17. 系统调用级别调试命令参考","slug":"_17-系统调用级别调试命令参考","link":"#_17-系统调用级别调试命令参考","children":[]}],"git":{"createdTime":1755014556000,"updatedTime":1755014556000,"contributors":[{"name":"hushengnian","email":"hushengnian@example.com","commits":1}]},"filePathRelative":"blogs/cloud-base/runc-container-lifecycle-diagrams.md"}');export{c as comp,B as data};
