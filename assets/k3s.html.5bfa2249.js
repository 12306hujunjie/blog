import{_ as o,r as d,o as i,c as a,e as s,a as t,b as r,d as l}from"./app.05a3b675.js";const p={},c={href:"https://docs.rancher.cn/docs/k3s/advanced/_index/#%E5%9C%A8-raspbian-buster-%E4%B8%8A%E5%90%AF%E7%94%A8%E6%97%A7%E7%89%88%E7%9A%84-iptables",target:"_blank",rel:"noopener noreferrer"},h={href:"https://docs.rancher.cn/docs/k3s/advanced/_index#alpine-linux-%E5%AE%89%E8%A3%85%E7%9A%84%E9%A2%9D%E5%A4%96%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C",target:"_blank",rel:"noopener noreferrer"},x={href:"https://docs.rancher.cn/docs/k3s/advanced/_index#Red-Hat-%E5%92%8C-CentOS-%E7%9A%84%E9%A2%9D%E5%A4%96%E5%87%86%E5%A4%87",target:"_blank",rel:"noopener noreferrer"},u={href:"https://docs.rancher.cn/docs/k3s/installation/ha/_index",target:"_blank",rel:"noopener noreferrer"};function g(k,e){const n=d("ExternalLinkIcon");return i(),a("div",null,[e[14]||(e[14]=s('<h2 id="\u4E00\u3001\u51C6\u5907\u5DE5\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001\u51C6\u5907\u5DE5\u4F5C" aria-hidden="true">#</a> \u4E00\u3001\u51C6\u5907\u5DE5\u4F5C</h2><h3 id="_1-\u5148\u51B3\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_1-\u5148\u51B3\u6761\u4EF6" aria-hidden="true">#</a> 1. \u5148\u51B3\u6761\u4EF6</h3><p>\u4E24\u4E2A\u8282\u70B9\u4E0D\u80FD\u6709\u76F8\u540C\u7684\u4E3B\u673A\u540D\u3002\u5982\u679C\u60A8\u7684\u6240\u6709\u8282\u70B9\u90FD\u6709\u76F8\u540C\u7684\u4E3B\u673A\u540D\uFF0C\u8BF7\u4F7F\u7528--with-node-id\u9009\u9879\u4E3A\u6BCF\u4E2A\u8282\u70B9\u6DFB\u52A0\u4E00\u4E2A\u968F\u673A\u540E\u7F00\uFF0C\u6216\u8005\u4E3A\u60A8\u6DFB\u52A0\u5230\u96C6\u7FA4\u7684\u6BCF\u4E2A\u8282\u70B9\u8BBE\u8BA1\u4E00\u4E2A\u72EC\u7279\u7684\u540D\u79F0\uFF0C\u7528--node-name\u6216$K3S_NODE_NAME\u4F20\u9012\u3002<br> \u5EFA\u8BAE\u5728\u4E00\u5F00\u59CB\u8BBE\u7F6E\u597D\u6240\u6709\u8282\u70B9\u7684hostname,\u5982<code>hostnamectl set-hostname master-node1</code></p><h3 id="_2-\u64CD\u4F5C\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#_2-\u64CD\u4F5C\u7CFB\u7EDF" aria-hidden="true">#</a> 2. \u64CD\u4F5C\u7CFB\u7EDF</h3><p>K3s \u6709\u671B\u5728\u5927\u591A\u6570\u73B0\u4EE3 Linux \u7CFB\u7EDF\u4E0A\u8FD0\u884C\u3002</p><p>\u6709\u4E9B\u64CD\u4F5C\u7CFB\u7EDF\u6709\u7279\u5B9A\u8981\u6C42\uFF1A</p>',6)),t("ul",null,[t("li",null,[e[1]||(e[1]=r("\u5982\u679C\u60A8\u4F7F\u7528\u7684\u662FRaspbian Buster\uFF0C\u8BF7\u6309\u7167")),t("a",c,[e[0]||(e[0]=r("\u8FD9\u4E9B\u6B65\u9AA4")),l(n)]),e[2]||(e[2]=r("\u5207\u6362\u5230\u4F20\u7EDF\u7684 iptables\u3002"))]),t("li",null,[e[4]||(e[4]=r("\u5982\u679C\u60A8\u4F7F\u7528\u7684\u662FAlpine Linux\uFF0C\u8BF7\u6309\u7167")),t("a",h,[e[3]||(e[3]=r("\u8FD9\u4E9B\u6B65\u9AA4")),l(n)]),e[5]||(e[5]=r("\u8FDB\u884C\u989D\u5916\u8BBE\u7F6E\u3002"))]),t("li",null,[e[7]||(e[7]=r("\u5982\u679C\u60A8\u4F7F\u7528\u7684\u662FRed Hat/CentOS\uFF0C\u8BF7\u6309\u7167")),t("a",x,[e[6]||(e[6]=r("\u8FD9\u4E9B\u6B65\u9AA4")),l(n)]),e[8]||(e[8]=r("\u8FDB\u884C\u989D\u5916\u8BBE\u7F6E\u3002"))])]),e[15]||(e[15]=s('<h3 id="_3-cpu-\u5185\u5B58\u548C\u78C1\u76D8" tabindex="-1"><a class="header-anchor" href="#_3-cpu-\u5185\u5B58\u548C\u78C1\u76D8" aria-hidden="true">#</a> 3. CPU,\u5185\u5B58\u548C\u78C1\u76D8</h3><p>\u6700\u4F4E\u8981\u6C42<code>1c1g</code>\u7684cpu\u548C\u5185\u5B58<br> \u78C1\u76D8\u7684\u6027\u80FD\u51B3\u5B9A\u4E86<code>k3s</code>\u7684\u6027\u80FD,\u5EFA\u8BAE\u4F7F\u7528ssd</p><h3 id="_4-\u7F51\u7EDC" tabindex="-1"><a class="header-anchor" href="#_4-\u7F51\u7EDC" aria-hidden="true">#</a> 4. \u7F51\u7EDC</h3><p>K3s server \u9700\u8981 6443 \u7AEF\u53E3\u624D\u80FD\u88AB\u6240\u6709\u8282\u70B9\u8BBF\u95EE\u3002</p><p>\u5F53\u4F7F\u7528 Flannel VXLAN \u65F6\uFF0C\u8282\u70B9\u9700\u8981\u80FD\u591F\u901A\u8FC7 UDP \u7AEF\u53E3 8472 \u8BBF\u95EE\u5176\u4ED6\u8282\u70B9\u3002\u8282\u70B9\u4E0D\u5E94\u8BE5\u5728\u5176\u4ED6\u7AEF\u53E3\u4E0A\u76D1\u542C\u3002K3s \u4F7F\u7528\u53CD\u5411\u96A7\u9053\uFF0C\u8FD9\u6837\u8282\u70B9\u4E0E\u670D\u52A1\u5668\u5EFA\u7ACB\u51FA\u7AD9\u8FDE\u63A5\uFF0C\u6240\u6709\u7684 kubelet \u6D41\u91CF\u90FD\u901A\u8FC7\u8BE5\u96A7\u9053\u8FD0\u884C\u3002\u7136\u800C\uFF0C\u5982\u679C\u4F60\u4E0D\u4F7F\u7528 Flannel \u5E76\u63D0\u4F9B\u81EA\u5DF1\u7684\u81EA\u5B9A\u4E49 CNI\uFF0C\u90A3\u4E48 K3s \u5C31\u4E0D\u9700\u8981 8472 \u7AEF\u53E3\u3002</p><p>\u5982\u679C\u8981\u4F7F\u7528metrics server\uFF0C\u5219\u9700\u8981\u5728\u6BCF\u4E2A\u8282\u70B9\u4E0A\u6253\u5F00\u7AEF\u53E3 10250 \u7AEF\u53E3\u3002</p><p>\u5982\u679C\u8BA1\u5212\u4F7F\u7528\u5D4C\u5165\u5F0F etcd \u5B9E\u73B0\u9AD8\u53EF\u7528\u6027\uFF0C\u5219 server \u8282\u70B9\u5FC5\u987B\u5728\u7AEF\u53E3 2379 \u548C 2380 \u4E0A\u53EF\u4EE5\u76F8\u4E92\u8BBF\u95EE\u3002</p><div class="custom-container tip"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">TIP</p><p>\u8282\u70B9\u4E0A\u7684 VXLAN \u7AEF\u53E3\u4E0D\u5E94\u516C\u5F00\u66B4\u9732\uFF0C\u56E0\u4E3A\u5B83\u516C\u5F00\u4E86\u96C6\u7FA4\u7F51\u7EDC\uFF0C\u4EFB\u4F55\u4EBA\u90FD\u53EF\u4EE5\u8BBF\u95EE\u5B83\u3002\u5E94\u5728\u7981\u6B62\u8BBF\u95EE\u7AEF\u53E3 8472 \u7684\u9632\u706B\u5899/\u5B89\u5168\u7EC4\u540E\u9762\u8FD0\u884C\u8282\u70B9\u3002</p></div><div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">WARNING</p><p>Flannel \u4F9D\u9760 Bridge CNI plugin \u6765\u521B\u5EFA\u4E00\u4E2A\u53EF\u4EE5\u4EA4\u6362\u6D41\u91CF\u7684 L2 \u7F51\u7EDC\u3002\u5177\u6709 NET_RAW \u529F\u80FD\u7684 Rogue pod \u53EF\u4EE5\u6EE5\u7528\u8BE5 L2 \u7F51\u7EDC\u6765\u53D1\u52A8\u653B\u51FB\uFF0C\u5982 ARP \u6B3A\u9A97\u3002\u56E0\u6B64\uFF0C\u6B63\u5982 kubernetes \u6587\u6863\u4E2D\u8BB0\u8F7D\u7684\u90A3\u6837\uFF0C\u8BF7\u8BBE\u7F6E\u4E00\u4E2A\u53D7\u9650\u914D\u7F6E\u6587\u4EF6\uFF0C\u5728\u4E0D\u53EF\u4FE1\u4EFB\u7684 pod \u4E0A\u7981\u7528 NET_RAW\u3002</p></div><table><thead><tr><th style="text-align:center;">\u534F\u8BAE</th><th style="text-align:center;">\u7AEF\u53E3</th><th style="text-align:center;">\u6E90</th><th style="text-align:center;">\u63CF\u8FF0</th></tr></thead><tbody><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">6443</td><td style="text-align:center;">K3s agent \u8282\u70B9</td><td style="text-align:center;">Kubernetes API Server</td></tr><tr><td style="text-align:center;">UDP</td><td style="text-align:center;">8472</td><td style="text-align:center;">K3s server \u548C agent \u8282\u70B9</td><td style="text-align:center;">\u4EC5\u5BF9 Flannel VXLAN \u9700\u8981</td></tr><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">10250</td><td style="text-align:center;">K3s server \u548C agent \u8282\u70B9</td><td style="text-align:center;">Kubelet metrics</td></tr><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">2379-2380</td><td style="text-align:center;">K3s server \u8282\u70B9</td><td style="text-align:center;">\u53EA\u6709\u5D4C\u5165\u5F0F etcd \u9AD8\u53EF\u7528\u624D\u9700\u8981</td></tr></tbody></table><p>\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u6240\u6709\u51FA\u7AD9\u6D41\u91CF\u90FD\u662F\u5141\u8BB8\u7684\u3002</p><h2 id="\u4E8C\u3001\u5FEB\u901F\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u5FEB\u901F\u5B89\u88C5" aria-hidden="true">#</a> \u4E8C\u3001\u5FEB\u901F\u5B89\u88C5</h2><ol><li>server \u56FD\u5185\u5B89\u88C5<br><code>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -</code></li><li>server \u56FD\u5916\u5B89\u88C5<br><code>curl -sfL https://get.k3s.io | sh -</code></li><li>worker \u56FD\u5185\u5B89\u88C5<br><code>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=${K3S_URL} K3S_TOKEN=${K3S_TOKEN} sh -</code></li><li>worker \u56FD\u5916\u5B89\u88C5<br><code>curl -sfL https://get.k3s.io | K3S_URL=${K3S_URL} K3S_TOKEN=${K3S_TOKEN} sh -</code></li></ol><p><strong>notice</strong>:</p>',14)),t("ul",null,[e[12]||(e[12]=s("<li><p>worker \u5B89\u88C5\u524D\u5148export\u4E00\u4E0B\u73AF\u5883\u53D8\u91CF<br><code>export K3S_URL=https://{ip or domain}:6443</code><br> ps: \u6B64\u5904\u82E5\u60F3\u8981api server\u9AD8\u53EF\u7528\uFF0C\u53EF\u6709\u4E09\u79CD\u65B9\u5F0F</p><ol><li>\u8D2D\u4E70\u5185\u7F51\u8D1F\u8F7D\u5747\u8861\u89E3\u6790\u5230\u76F8\u5173server\u8282\u70B9\u7AEF\u53E3</li><li>DNS\u8D1F\u8F7D\u5747\u8861\u89E3\u6790</li><li>VIP\u6216\u8005\u5F39\u6027ip <code>export K3S_TOKEN=xxxxx::server:xxxxx</code></li></ol></li><li><p><code>K3S_TOKEN</code> \u5728server\u73AF\u5883\u7684<code>/var/lib/rancher/k3s/server/node-token</code>\u8DEF\u5F84</p></li><li><p>\u6BCF\u53F0\u8BA1\u7B97\u673A\u5FC5\u987B\u5177\u6709\u552F\u4E00\u7684\u4E3B\u673A\u540D\u3002\u5982\u679C\u60A8\u7684\u8BA1\u7B97\u673A\u6CA1\u6709\u552F\u4E00\u7684\u4E3B\u673A\u540D\uFF0C\u8BF7\u4F20\u9012<code>K3S_NODE_NAME</code>\u73AF\u5883\u53D8\u91CF\uFF0C\u5E76\u4E3A\u6BCF\u4E2A\u8282\u70B9\u63D0\u4F9B\u4E00\u4E2A\u6709\u6548\u4E14\u552F\u4E00\u7684\u4E3B\u673A\u540D\u3002</p></li>",3)),t("li",null,[t("p",null,[t("a",u,[e[9]||(e[9]=r("\u9AD8\u53EF\u7528\u5B89\u88C5")),l(n)]),e[10]||(e[10]=r("\u65F6\u53EF\u4F7F\u7528\u5916\u90E8\u6570\u636E\u5E93 ")),e[11]||(e[11]=t("code",null,"--datastore-endpoint='mysql://user:pass@tcp(url:port)/database'",-1))])]),e[13]||(e[13]=t("li",null,[t("p",null,[r("\u7531\u4E8Ek3sv2\u4E4B\u540E\u5F3A\u5236\u5B89\u88C5\u7684traefik\u4E5F\u5347\u7EA7\u5230v2\u7248\u672C\uFF0C\u4E0E\u5F53\u524Dnginx ingress\u914D\u7F6E\u5B8C\u5168\u4E0D\u517C\u5BB9\uFF0C\u672C\u6B21\u9009\u7528\u6307\u5B9A\u7248\u672C, \u5B89\u88C5\u524Dexport\u4E00\u4E0B\u73AF\u5883\u53D8\u91CF"),t("code",null,"INSTALL_K3S_VERSION=v1.19.16+k3s1")])],-1))]),e[16]||(e[16]=t("p",null,"\u81F3\u6B64\u5C31\u5B8C\u6210\u4E86\u{1F389}",-1))])}const v=o(p,[["render",g],["__file","k3s.html.vue"]]);export{v as default};
