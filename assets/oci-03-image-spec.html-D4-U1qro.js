import{_ as o,c,b as n,a as r,d as a,e,w as p,r as l,o as d}from"./app-DDxSucZD.js";const u={},v={href:"https://github.com/opencontainers/image-spec",target:"_blank",rel:"noopener noreferrer"};function k(m,s){const t=l("RouteLink"),i=l("ExternalLinkIcon");return d(),c("div",null,[s[31]||(s[31]=n("h1",{id:"oci-image-规范详解-容器镜像格式与构建",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#oci-image-规范详解-容器镜像格式与构建"},[n("span",null,"OCI Image 规范详解 - 容器镜像格式与构建")])],-1)),n("blockquote",null,[n("p",null,[s[2]||(s[2]=n("strong",null,"系列导航：",-1)),s[3]||(s[3]=a()),e(t,{to:"/blogs/cloud-base/oci-series-index.html"},{default:p(()=>s[0]||(s[0]=[a("OCI 容器技术完全指南系列")])),_:1,__:[0]}),s[4]||(s[4]=a(" → 第三篇：镜像规范")),s[5]||(s[5]=n("br",null,null,-1)),s[6]||(s[6]=n("strong",null,"规范版本：",-1)),s[7]||(s[7]=a(" OCI Image Spec v1.0.2")),s[8]||(s[8]=n("br",null,null,-1)),s[9]||(s[9]=n("strong",null,"参考仓库：",-1)),s[10]||(s[10]=a()),n("a",v,[s[1]||(s[1]=a("opencontainers/image-spec")),e(i)]),s[11]||(s[11]=n("br",null,null,-1)),s[12]||(s[12]=n("strong",null,"最后更新：",-1)),s[13]||(s[13]=a(" 2024-07-10"))])]),s[32]||(s[32]=r(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>OCI Image Specification 定义了容器镜像的标准格式和元数据规范，确保镜像在不同平台和工具间的互操作性。本文将深入解析镜像格式、层级结构、多架构支持等核心概念，帮助您掌握容器镜像的构建和管理。</p><h2 id="镜像基础概念" tabindex="-1"><a class="header-anchor" href="#镜像基础概念"><span>镜像基础概念</span></a></h2><h3 id="镜像组成" tabindex="-1"><a class="header-anchor" href="#镜像组成"><span>镜像组成</span></a></h3><p>OCI 镜像由以下核心组件构成：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">OCI 镜像</span>
<span class="line">├── 镜像清单 (Image Manifest)     # 描述镜像内容的 JSON 文档</span>
<span class="line">├── 镜像配置 (Image Config)       # 包含镜像元数据和运行时配置</span>
<span class="line">└── 镜像层 (Image Layers)        # 文件系统变更的 tar 归档</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="内容寻址存储" tabindex="-1"><a class="header-anchor" href="#内容寻址存储"><span>内容寻址存储</span></a></h3><p>OCI 镜像使用内容寻址存储，每个组件通过其内容的加密哈希值进行唯一标识：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.config.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:a9561eb1b190625c9adb5a9513e72c4dedafc1cb2d4c5236c9a6957ec7dfd5a9&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="镜像清单-image-manifest" tabindex="-1"><a class="header-anchor" href="#镜像清单-image-manifest"><span>镜像清单 (Image Manifest)</span></a></h2><p>镜像清单是描述镜像结构的 JSON 文档，定义了镜像的所有组件：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;schemaVersion&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.manifest.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.config.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:config-hash&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;layers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">5678</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:layer1-hash&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">9012</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:layer2-hash&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;annotations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-10T10:00:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.authors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OCI Community&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="清单字段说明" tabindex="-1"><a class="header-anchor" href="#清单字段说明"><span>清单字段说明</span></a></h3><table><thead><tr><th>字段</th><th>类型</th><th>必需</th><th>说明</th></tr></thead><tbody><tr><td><code>schemaVersion</code></td><td>integer</td><td>是</td><td>清单格式版本，当前为 2</td></tr><tr><td><code>mediaType</code></td><td>string</td><td>否</td><td>清单的媒体类型</td></tr><tr><td><code>config</code></td><td>object</td><td>是</td><td>镜像配置对象的描述符</td></tr><tr><td><code>layers</code></td><td>array</td><td>是</td><td>镜像层的描述符数组</td></tr><tr><td><code>annotations</code></td><td>object</td><td>否</td><td>任意元数据键值对</td></tr></tbody></table><h2 id="镜像配置对象" tabindex="-1"><a class="header-anchor" href="#镜像配置对象"><span>镜像配置对象</span></a></h2><p>镜像配置包含镜像的元数据和默认运行时配置：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-10T10:00:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OCI Community&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;architecture&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amd64&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;os&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linux&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;User&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1000:1000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Env&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;CONTAINER=oci&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Entrypoint&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/my-app&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Cmd&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--config&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/app.conf&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;WorkingDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/app&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;StopSignal&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SIGTERM&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ExposedPorts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;80/tcp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;443/tcp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;rootfs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;layers&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;diff_ids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;sha256:layer1-diff-id&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;sha256:layer2-diff-id&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;history&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-10T09:00:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;created_by&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FROM ubuntu:20.04&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;empty_layer&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-10T09:30:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;created_by&quot;</span><span class="token operator">:</span> <span class="token string">&quot;COPY app /bin/my-app&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;empty_layer&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行时配置" tabindex="-1"><a class="header-anchor" href="#运行时配置"><span>运行时配置</span></a></h3><p>镜像配置中的运行时参数将作为容器的默认配置：</p><table><thead><tr><th>字段</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>User</code></td><td>默认用户</td><td><code>&quot;1000:1000&quot;</code></td></tr><tr><td><code>Env</code></td><td>环境变量</td><td><code>[&quot;PATH=/usr/bin&quot;]</code></td></tr><tr><td><code>Entrypoint</code></td><td>入口点命令</td><td><code>[&quot;/bin/sh&quot;]</code></td></tr><tr><td><code>Cmd</code></td><td>默认参数</td><td><code>[&quot;-c&quot;, &quot;echo hello&quot;]</code></td></tr><tr><td><code>WorkingDir</code></td><td>工作目录</td><td><code>&quot;/app&quot;</code></td></tr><tr><td><code>StopSignal</code></td><td>停止信号</td><td><code>&quot;SIGTERM&quot;</code></td></tr></tbody></table><h3 id="平台信息" tabindex="-1"><a class="header-anchor" href="#平台信息"><span>平台信息</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;architecture&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amd64&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;os&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linux&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;variant&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v8&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>支持的 Linux 架构：</strong></p><ul><li><code>amd64</code> (x86_64)</li><li><code>arm64</code> (aarch64)</li><li><code>arm</code> (v6, v7, v8)</li><li><code>ppc64le</code> (PowerPC 64-bit Little Endian)</li><li><code>riscv64</code> (RISC-V 64-bit)</li><li><code>s390x</code> (IBM System z)</li></ul><h2 id="镜像层格式" tabindex="-1"><a class="header-anchor" href="#镜像层格式"><span>镜像层格式</span></a></h2><h3 id="媒体类型" tabindex="-1"><a class="header-anchor" href="#媒体类型"><span>媒体类型</span></a></h3><p>OCI 支持多种层格式：</p><ul><li><code>application/vnd.oci.image.layer.v1.tar</code> - 未压缩 tar 归档</li><li><code>application/vnd.oci.image.layer.v1.tar+gzip</code> - Gzip 压缩层</li><li><code>application/vnd.oci.image.layer.v1.tar+zstd</code> - Zstd 压缩层</li></ul><h3 id="layer-diffid-和-chainid" tabindex="-1"><a class="header-anchor" href="#layer-diffid-和-chainid"><span>Layer DiffID 和 ChainID</span></a></h3><p><strong>DiffID：</strong> 层内容的未压缩哈希值</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DiffID = SHA256(uncompressed_layer_content)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ChainID：</strong> 层级应用后的复合哈希值</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">ChainID(L₀) = DiffID(L₀)</span>
<span class="line">ChainID(L₀|...|Lₙ) = SHA256(ChainID(L₀|...|Lₙ₋₁) + &quot; &quot; + DiffID(Lₙ))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="linux-文件系统特性" tabindex="-1"><a class="header-anchor" href="#linux-文件系统特性"><span>Linux 文件系统特性</span></a></h3><h4 id="whiteout-文件" tabindex="-1"><a class="header-anchor" href="#whiteout-文件"><span>Whiteout 文件</span></a></h4><p>用于在联合文件系统中表示文件删除：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 删除文件</span></span>
<span class="line">.wh.filename</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 删除目录 (不透明 whiteout)</span></span>
<span class="line">.wh<span class="token punctuation">..</span>wh<span class="token punctuation">..</span>opq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="文件属性支持" tabindex="-1"><a class="header-anchor" href="#文件属性支持"><span>文件属性支持</span></a></h4><ul><li><strong>权限位</strong>: 标准 POSIX 权限</li><li><strong>所有权</strong>: uid/gid 信息</li><li><strong>扩展属性</strong>: Linux xattrs</li><li><strong>硬链接</strong>: POSIX 硬链接支持</li></ul><h2 id="多架构支持" tabindex="-1"><a class="header-anchor" href="#多架构支持"><span>多架构支持</span></a></h2><h3 id="镜像索引" tabindex="-1"><a class="header-anchor" href="#镜像索引"><span>镜像索引</span></a></h3><p>镜像索引允许单一名称指向多个平台的镜像：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;schemaVersion&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.index.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;manifests&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.manifest.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:amd64-manifest&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;architecture&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amd64&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;os&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linux&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;mediaType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.oci.image.manifest.v1+json&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">5678</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:arm64-manifest&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;architecture&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arm64&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;os&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linux&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;variant&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v8&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;annotations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.ref.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myapp:latest&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="构建多架构镜像" tabindex="-1"><a class="header-anchor" href="#构建多架构镜像"><span>构建多架构镜像</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 使用 Docker Buildx</span></span>
<span class="line"><span class="token function">docker</span> buildx create <span class="token parameter variable">--use</span></span>
<span class="line"><span class="token function">docker</span> buildx build <span class="token parameter variable">--platform</span> linux/amd64,linux/arm64 <span class="token parameter variable">-t</span> myapp:latest <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 Podman</span></span>
<span class="line"><span class="token function">podman</span> manifest create myapp:latest</span>
<span class="line"><span class="token function">podman</span> build <span class="token parameter variable">--platform</span> linux/amd64 <span class="token parameter variable">-t</span> myapp:amd64 <span class="token builtin class-name">.</span></span>
<span class="line"><span class="token function">podman</span> build <span class="token parameter variable">--platform</span> linux/arm64 <span class="token parameter variable">-t</span> myapp:arm64 <span class="token builtin class-name">.</span></span>
<span class="line"><span class="token function">podman</span> manifest <span class="token function">add</span> myapp:latest myapp:amd64</span>
<span class="line"><span class="token function">podman</span> manifest <span class="token function">add</span> myapp:latest myapp:arm64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="镜像构建最佳实践" tabindex="-1"><a class="header-anchor" href="#镜像构建最佳实践"><span>镜像构建最佳实践</span></a></h2><h3 id="dockerfile-优化" tabindex="-1"><a class="header-anchor" href="#dockerfile-优化"><span>Dockerfile 优化</span></a></h3><h4 id="层级优化" tabindex="-1"><a class="header-anchor" href="#层级优化"><span>层级优化</span></a></h4><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 不推荐：每个 RUN 创建一个层</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get install -y curl</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get clean</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 推荐：合并相关操作</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get install -y curl &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get clean &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多阶段构建" tabindex="-1"><a class="header-anchor" href="#多阶段构建"><span>多阶段构建</span></a></h4><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 构建阶段</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> golang:1.19 <span class="token keyword">AS</span> builder</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> . .</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> go build -o myapp</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 运行阶段</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> alpine:3.18</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apk --no-cache add ca-certificates</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /app/myapp /usr/local/bin/</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/usr/local/bin/myapp&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="dockerignore-文件" tabindex="-1"><a class="header-anchor" href="#dockerignore-文件"><span>.dockerignore 文件</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># .dockerignore</span>
<span class="line">.git</span>
<span class="line">*.md</span>
<span class="line">Dockerfile</span>
<span class="line">.dockerignore</span>
<span class="line">node_modules</span>
<span class="line">*.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安全最佳实践" tabindex="-1"><a class="header-anchor" href="#安全最佳实践"><span>安全最佳实践</span></a></h3><h4 id="最小化基础镜像" tabindex="-1"><a class="header-anchor" href="#最小化基础镜像"><span>最小化基础镜像</span></a></h4><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 使用 distroless 镜像</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> gcr.io/distroless/static-debian11</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 或使用 Alpine Linux</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> alpine:3.18</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apk --no-cache add ca-certificates</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="非-root-用户" tabindex="-1"><a class="header-anchor" href="#非-root-用户"><span>非 root 用户</span></a></h4><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 创建非特权用户</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> adduser -D -s /bin/sh appuser</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">USER</span> appuser</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 或使用数字 UID</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">USER</span> 1000:1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="漏洞扫描" tabindex="-1"><a class="header-anchor" href="#漏洞扫描"><span>漏洞扫描</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 使用 Trivy 扫描</span></span>
<span class="line">trivy image myapp:latest</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 Grype 扫描</span></span>
<span class="line">grype myapp:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="性能优化" tabindex="-1"><a class="header-anchor" href="#性能优化"><span>性能优化</span></a></h3><h4 id="层缓存策略" tabindex="-1"><a class="header-anchor" href="#层缓存策略"><span>层缓存策略</span></a></h4><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 将变化频率低的内容放在前面</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> requirements.txt .</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> pip install -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将变化频率高的内容放在后面</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> src/ ./src/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="压缩算法选择" tabindex="-1"><a class="header-anchor" href="#压缩算法选择"><span>压缩算法选择</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 使用 zstd 压缩（更快的解压）</span></span>
<span class="line"><span class="token function">docker</span> build <span class="token parameter variable">--compress</span><span class="token operator">=</span>zstd <span class="token parameter variable">-t</span> myapp:latest <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 对比不同压缩算法</span></span>
<span class="line"><span class="token function">docker</span> images <span class="token parameter variable">--format</span> <span class="token string">&quot;table {{.Repository}}<span class="token entity" title="\\t">\\t</span>{{.Tag}}<span class="token entity" title="\\t">\\t</span>{{.Size}}&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="工具和生态系统" tabindex="-1"><a class="header-anchor" href="#工具和生态系统"><span>工具和生态系统</span></a></h2><h3 id="镜像构建工具" tabindex="-1"><a class="header-anchor" href="#镜像构建工具"><span>镜像构建工具</span></a></h3><ul><li><strong>Docker</strong>: 最流行的容器构建工具</li><li><strong>Podman</strong>: 无守护进程的容器工具</li><li><strong>Buildah</strong>: 专注于镜像构建的工具</li><li><strong>Kaniko</strong>: Kubernetes 原生构建工具</li></ul><h3 id="镜像分析工具" tabindex="-1"><a class="header-anchor" href="#镜像分析工具"><span>镜像分析工具</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 使用 dive 分析镜像层</span></span>
<span class="line">dive myapp:latest</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 skopeo 检查镜像</span></span>
<span class="line">skopeo inspect docker://myapp:latest</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 umoci 操作 OCI 镜像</span></span>
<span class="line">umoci unpack <span class="token parameter variable">--image</span> myapp:latest bundle</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ci-cd-集成" tabindex="-1"><a class="header-anchor" href="#ci-cd-集成"><span>CI/CD 集成</span></a></h3><h4 id="github-actions-示例" tabindex="-1"><a class="header-anchor" href="#github-actions-示例"><span>GitHub Actions 示例</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">name</span><span class="token punctuation">:</span> Build and Push Image</span>
<span class="line"><span class="token key atrule">on</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">push</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">build</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3</span>
<span class="line">    </span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Docker Buildx</span>
<span class="line">      <span class="token key atrule">uses</span><span class="token punctuation">:</span> docker/setup<span class="token punctuation">-</span>buildx<span class="token punctuation">-</span>action@v2</span>
<span class="line">    </span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build and push</span>
<span class="line">      <span class="token key atrule">uses</span><span class="token punctuation">:</span> docker/build<span class="token punctuation">-</span>push<span class="token punctuation">-</span>action@v4</span>
<span class="line">      <span class="token key atrule">with</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">context</span><span class="token punctuation">:</span> .</span>
<span class="line">        <span class="token key atrule">platforms</span><span class="token punctuation">:</span> linux/amd64<span class="token punctuation">,</span>linux/arm64</span>
<span class="line">        <span class="token key atrule">push</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">tags</span><span class="token punctuation">:</span> myregistry/myapp<span class="token punctuation">:</span>latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="镜像标注规范" tabindex="-1"><a class="header-anchor" href="#镜像标注规范"><span>镜像标注规范</span></a></h2><h3 id="预定义标注" tabindex="-1"><a class="header-anchor" href="#预定义标注"><span>预定义标注</span></a></h3><p>OCI 定义了一系列标准标注键：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;annotations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-10T10:00:00Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.authors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OCI Community&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/myorg/myapp&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.documentation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://docs.myapp.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/myorg/myapp&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.revision&quot;</span><span class="token operator">:</span> <span class="token string">&quot;abc123&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.vendor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My Organization&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.licenses&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Apache-2.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My Application&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;org.opencontainers.image.description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A sample OCI image&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义标注" tabindex="-1"><a class="header-anchor" href="#自定义标注"><span>自定义标注</span></a></h3><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token instruction"><span class="token keyword">LABEL</span> org.mycompany.team=<span class="token string">&quot;platform&quot;</span></span></span>
<span class="line"><span class="token instruction"><span class="token keyword">LABEL</span> org.mycompany.build-date=<span class="token string">&quot;2024-07-10&quot;</span></span></span>
<span class="line"><span class="token instruction"><span class="token keyword">LABEL</span> org.mycompany.environment=<span class="token string">&quot;production&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="下一步学习" tabindex="-1"><a class="header-anchor" href="#下一步学习"><span>下一步学习</span></a></h2><p>完成 Image 规范学习后，建议继续学习：</p>`,81)),n("ol",null,[n("li",null,[n("strong",null,[e(t,{to:"/blogs/cloud-base/oci-04-distribution-spec.html"},{default:p(()=>s[14]||(s[14]=[a("OCI Distribution 规范详解")])),_:1,__:[14]})]),s[15]||(s[15]=a(" - 了解镜像分发协议"))]),n("li",null,[n("strong",null,[e(t,{to:"/blogs/cloud-base/oci-05-security-guide.html"},{default:p(()=>s[16]||(s[16]=[a("OCI 容器安全配置实战")])),_:1,__:[16]})]),s[17]||(s[17]=a(" - 学习镜像安全实践"))]),n("li",null,[n("strong",null,[e(t,{to:"/blogs/cloud-base/oci-07-production-guide.html"},{default:p(()=>s[18]||(s[18]=[a("OCI 容器生产环境实践案例")])),_:1,__:[18]})]),s[19]||(s[19]=a(" - 掌握生产环境应用"))])]),s[33]||(s[33]=n("h2",{id:"总结",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#总结"},[n("span",null,"总结")])],-1)),s[34]||(s[34]=n("p",null,"OCI Image 规范为容器镜像提供了标准化的格式定义，通过层级化存储、内容寻址、多架构支持等特性，确保了镜像的可移植性和互操作性。掌握镜像规范对于构建高效、安全的容器化应用至关重要。",-1)),s[35]||(s[35]=n("p",null,[n("strong",null,"关键要点：")],-1)),s[36]||(s[36]=n("ul",null,[n("li",null,"镜像采用内容寻址存储确保完整性"),n("li",null,"层级化结构支持增量更新和缓存"),n("li",null,"多架构支持实现跨平台部署"),n("li",null,"标注机制提供丰富的元数据支持")],-1)),s[37]||(s[37]=n("hr",null,null,-1)),n("p",null,[s[23]||(s[23]=n("strong",null,"上一篇：",-1)),s[24]||(s[24]=a()),e(t,{to:"/blogs/cloud-base/oci-02-runtime-spec.html"},{default:p(()=>s[20]||(s[20]=[a("OCI Runtime 规范详解 - Linux 容器配置完全指南")])),_:1,__:[20]}),s[25]||(s[25]=n("br",null,null,-1)),s[26]||(s[26]=n("strong",null,"下一篇：",-1)),s[27]||(s[27]=a()),e(t,{to:"/blogs/cloud-base/oci-04-distribution-spec.html"},{default:p(()=>s[21]||(s[21]=[a("OCI Distribution 规范详解 - 容器镜像分发协议")])),_:1,__:[21]}),s[28]||(s[28]=n("br",null,null,-1)),s[29]||(s[29]=n("strong",null,"返回：",-1)),s[30]||(s[30]=a()),e(t,{to:"/blogs/cloud-base/oci-series-index.html"},{default:p(()=>s[22]||(s[22]=[a("OCI 容器技术完全指南系列")])),_:1,__:[22]})])])}const h=o(u,[["render",k]]),g=JSON.parse('{"path":"/blogs/cloud-base/oci-03-image-spec.html","title":"OCI Image 规范详解 - 容器镜像格式与构建","lang":"en-US","frontmatter":{"categories":["cloud-base"]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"镜像基础概念","slug":"镜像基础概念","link":"#镜像基础概念","children":[{"level":3,"title":"镜像组成","slug":"镜像组成","link":"#镜像组成","children":[]},{"level":3,"title":"内容寻址存储","slug":"内容寻址存储","link":"#内容寻址存储","children":[]}]},{"level":2,"title":"镜像清单 (Image Manifest)","slug":"镜像清单-image-manifest","link":"#镜像清单-image-manifest","children":[{"level":3,"title":"清单字段说明","slug":"清单字段说明","link":"#清单字段说明","children":[]}]},{"level":2,"title":"镜像配置对象","slug":"镜像配置对象","link":"#镜像配置对象","children":[{"level":3,"title":"运行时配置","slug":"运行时配置","link":"#运行时配置","children":[]},{"level":3,"title":"平台信息","slug":"平台信息","link":"#平台信息","children":[]}]},{"level":2,"title":"镜像层格式","slug":"镜像层格式","link":"#镜像层格式","children":[{"level":3,"title":"媒体类型","slug":"媒体类型","link":"#媒体类型","children":[]},{"level":3,"title":"Layer DiffID 和 ChainID","slug":"layer-diffid-和-chainid","link":"#layer-diffid-和-chainid","children":[]},{"level":3,"title":"Linux 文件系统特性","slug":"linux-文件系统特性","link":"#linux-文件系统特性","children":[]}]},{"level":2,"title":"多架构支持","slug":"多架构支持","link":"#多架构支持","children":[{"level":3,"title":"镜像索引","slug":"镜像索引","link":"#镜像索引","children":[]},{"level":3,"title":"构建多架构镜像","slug":"构建多架构镜像","link":"#构建多架构镜像","children":[]}]},{"level":2,"title":"镜像构建最佳实践","slug":"镜像构建最佳实践","link":"#镜像构建最佳实践","children":[{"level":3,"title":"Dockerfile 优化","slug":"dockerfile-优化","link":"#dockerfile-优化","children":[]},{"level":3,"title":"安全最佳实践","slug":"安全最佳实践","link":"#安全最佳实践","children":[]},{"level":3,"title":"性能优化","slug":"性能优化","link":"#性能优化","children":[]}]},{"level":2,"title":"工具和生态系统","slug":"工具和生态系统","link":"#工具和生态系统","children":[{"level":3,"title":"镜像构建工具","slug":"镜像构建工具","link":"#镜像构建工具","children":[]},{"level":3,"title":"镜像分析工具","slug":"镜像分析工具","link":"#镜像分析工具","children":[]},{"level":3,"title":"CI/CD 集成","slug":"ci-cd-集成","link":"#ci-cd-集成","children":[]}]},{"level":2,"title":"镜像标注规范","slug":"镜像标注规范","link":"#镜像标注规范","children":[{"level":3,"title":"预定义标注","slug":"预定义标注","link":"#预定义标注","children":[]},{"level":3,"title":"自定义标注","slug":"自定义标注","link":"#自定义标注","children":[]}]},{"level":2,"title":"下一步学习","slug":"下一步学习","link":"#下一步学习","children":[]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1752167911000,"updatedTime":1752167911000,"contributors":[{"name":"户盛年","email":"hushengnian@hushengniandeMacBook-Air.local","commits":1}]},"filePathRelative":"blogs/cloud-base/oci-03-image-spec.md"}');export{h as comp,g as data};
