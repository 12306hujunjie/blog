import{_ as c,c as u,b as n,a as o,e as a,d as p,w as e,r as l,o as r}from"./app-2O6audqE.js";const d={},k={href:"https://github.com/opencontainers/runtime-spec",target:"_blank",rel:"noopener noreferrer"};function v(m,s){const t=l("RouteLink"),i=l("ExternalLinkIcon");return r(),u("div",null,[s[35]||(s[35]=n("h1",{id:"oci-runtime-规范详解-linux-容器配置完全指南",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#oci-runtime-规范详解-linux-容器配置完全指南"},[n("span",null,"OCI Runtime 规范详解 - Linux 容器配置完全指南")])],-1)),n("blockquote",null,[n("p",null,[s[2]||(s[2]=n("strong",null,"系列导航：",-1)),s[3]||(s[3]=a()),p(t,{to:"/blogs/cloud-base/oci-series-index.html"},{default:e(()=>s[0]||(s[0]=[a("OCI 容器技术完全指南系列")])),_:1,__:[0]}),s[4]||(s[4]=a(" → 第二篇：运行时规范")),s[5]||(s[5]=n("br",null,null,-1)),s[6]||(s[6]=n("strong",null,"规范版本：",-1)),s[7]||(s[7]=a(" OCI Runtime Spec v1.0.2")),s[8]||(s[8]=n("br",null,null,-1)),s[9]||(s[9]=n("strong",null,"参考仓库：",-1)),s[10]||(s[10]=a()),n("a",k,[s[1]||(s[1]=a("opencontainers/runtime-spec")),p(i)]),s[11]||(s[11]=n("br",null,null,-1)),s[12]||(s[12]=n("strong",null,"最后更新：",-1)),s[13]||(s[13]=a(" 2024-07-10"))])]),s[36]||(s[36]=o(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>OCI Runtime Specification 定义了容器运行时的标准化接口和行为规范，是 OCI 三大规范中最核心的部分。本文将深入解析 Runtime 规范中的 Linux 相关配置，帮助您全面掌握容器运行时的配置和管理。</p><h2 id="核心配置结构" tabindex="-1"><a class="header-anchor" href="#核心配置结构"><span>核心配置结构</span></a></h2><p>OCI 运行时配置以 JSON 格式定义，主要包含以下结构：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ociVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;process&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> </span>
<span class="line">        <span class="token property">&quot;terminal&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">&quot;gid&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PATH=/usr/local/bin:/usr/bin:/bin&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;capabilities&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;noNewPrivileges&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rootfs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;readonly&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;container-hostname&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;mounts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ... <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置字段说明" tabindex="-1"><a class="header-anchor" href="#配置字段说明"><span>配置字段说明</span></a></h3><table><thead><tr><th>字段</th><th>类型</th><th>必需</th><th>说明</th></tr></thead><tbody><tr><td><code>ociVersion</code></td><td>string</td><td>是</td><td>OCI 规范版本</td></tr><tr><td><code>process</code></td><td>object</td><td>否</td><td>进程配置</td></tr><tr><td><code>root</code></td><td>object</td><td>否</td><td>根文件系统配置</td></tr><tr><td><code>hostname</code></td><td>string</td><td>否</td><td>容器主机名</td></tr><tr><td><code>mounts</code></td><td>array</td><td>否</td><td>挂载点配置</td></tr><tr><td><code>linux</code></td><td>object</td><td>否</td><td>Linux 专用配置</td></tr><tr><td><code>hooks</code></td><td>object</td><td>否</td><td>生命周期 Hook</td></tr></tbody></table><h2 id="linux-专用配置" tabindex="-1"><a class="header-anchor" href="#linux-专用配置"><span>Linux 专用配置</span></a></h2><p>Linux 配置是运行时规范的核心，涵盖了 Linux 内核的各种隔离和安全特性：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> Linux <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    UIDMappings       <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxIDMapping    <span class="token comment">// 用户 ID 映射</span></span>
<span class="line">    GIDMappings       <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxIDMapping    <span class="token comment">// 组 ID 映射</span></span>
<span class="line">    Namespaces        <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxNamespace    <span class="token comment">// 命名空间配置</span></span>
<span class="line">    Resources         <span class="token operator">*</span>LinuxResources     <span class="token comment">// 资源限制 (cgroups)</span></span>
<span class="line">    Devices          <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxDevice       <span class="token comment">// 设备配置</span></span>
<span class="line">    Seccomp          <span class="token operator">*</span>LinuxSeccomp       <span class="token comment">// 系统调用过滤</span></span>
<span class="line">    Capabilities     <span class="token operator">*</span>LinuxCapabilities  <span class="token comment">// 能力控制</span></span>
<span class="line">    MaskedPaths      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>            <span class="token comment">// 隐藏路径</span></span>
<span class="line">    ReadonlyPaths    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>            <span class="token comment">// 只读路径</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="命名空间隔离" tabindex="-1"><a class="header-anchor" href="#命名空间隔离"><span>命名空间隔离</span></a></h3><p>Linux 支持 8 种命名空间类型，提供不同层面的隔离：</p><table><thead><tr><th>命名空间类型</th><th>作用域</th><th>说明</th></tr></thead><tbody><tr><td><code>pid</code></td><td>进程隔离</td><td>进程 ID 空间隔离</td></tr><tr><td><code>network</code></td><td>网络栈隔离</td><td>网络接口、路由表隔离</td></tr><tr><td><code>mount</code></td><td>挂载点隔离</td><td>文件系统挂载表隔离</td></tr><tr><td><code>ipc</code></td><td>IPC 隔离</td><td>System V IPC、POSIX 消息队列隔离</td></tr><tr><td><code>uts</code></td><td>主机名隔离</td><td>主机名和域名隔离</td></tr><tr><td><code>user</code></td><td>用户隔离</td><td>用户和组 ID 重映射</td></tr><tr><td><code>cgroup</code></td><td>Cgroup 隔离</td><td>Cgroup 层次结构隔离</td></tr><tr><td><code>time</code></td><td>时钟隔离</td><td>系统时钟隔离</td></tr></tbody></table><h4 id="用户命名空间映射示例" tabindex="-1"><a class="header-anchor" href="#用户命名空间映射示例"><span>用户命名空间映射示例</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;uidMappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;containerID&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;hostID&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">65536</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;gidMappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;containerID&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;hostID&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">65536</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="资源管理-cgroups" tabindex="-1"><a class="header-anchor" href="#资源管理-cgroups"><span>资源管理 (Cgroups)</span></a></h3><h4 id="内存资源控制" tabindex="-1"><a class="header-anchor" href="#内存资源控制"><span>内存资源控制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxMemory <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Limit           <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 内存限制 (字节)</span></span>
<span class="line">    Reservation     <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 软限制</span></span>
<span class="line">    Swap            <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 内存+交换限制</span></span>
<span class="line">    Swappiness      <span class="token operator">*</span><span class="token builtin">uint64</span> <span class="token comment">// 交换倾向 (0-100)</span></span>
<span class="line">    DisableOOMKiller <span class="token operator">*</span><span class="token builtin">bool</span>  <span class="token comment">// 禁用 OOM Killer</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cpu-资源控制" tabindex="-1"><a class="header-anchor" href="#cpu-资源控制"><span>CPU 资源控制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxCPU <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Shares          <span class="token operator">*</span><span class="token builtin">uint64</span> <span class="token comment">// CPU 权重 (相对权重)</span></span>
<span class="line">    Quota           <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// CPU 配额 (微秒) - 在给定周期内允许的 CPU 时间</span></span>
<span class="line">    Burst           <span class="token operator">*</span><span class="token builtin">uint64</span> <span class="token comment">// CPU 突发限制 (微秒) - 给定周期内额外允许的累积 CPU 时间</span></span>
<span class="line">    Period          <span class="token operator">*</span><span class="token builtin">uint64</span> <span class="token comment">// CPU 周期 (微秒) - 用于硬限制</span></span>
<span class="line">    RealtimeRuntime <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 实时调度可使用的时间 (微秒)</span></span>
<span class="line">    RealtimePeriod  <span class="token operator">*</span><span class="token builtin">uint64</span> <span class="token comment">// 实时调度的 CPU 周期 (微秒)</span></span>
<span class="line">    Cpus            <span class="token builtin">string</span>  <span class="token comment">// CPU 集合 (如 &quot;0-3,7&quot;) - cpuset 内使用的 CPU</span></span>
<span class="line">    Mems            <span class="token builtin">string</span>  <span class="token comment">// 内存节点 - cpuset 内的内存节点列表</span></span>
<span class="line">    Idle            <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 空闲配置: 0=默认行为, 1=SCHED_IDLE</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="块设备-i-o-控制" tabindex="-1"><a class="header-anchor" href="#块设备-i-o-控制"><span>块设备 I/O 控制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxBlockIO <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Weight                   <span class="token operator">*</span><span class="token builtin">uint16</span>               <span class="token comment">// I/O 权重</span></span>
<span class="line">    ThrottleReadBpsDevice   <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxThrottleDevice <span class="token comment">// 读取带宽限制</span></span>
<span class="line">    ThrottleWriteBpsDevice  <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxThrottleDevice <span class="token comment">// 写入带宽限制</span></span>
<span class="line">    ThrottleReadIOPSDevice  <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxThrottleDevice <span class="token comment">// 读取 IOPS 限制</span></span>
<span class="line">    ThrottleWriteIOPSDevice <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxThrottleDevice <span class="token comment">// 写入 IOPS 限制</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安全配置" tabindex="-1"><a class="header-anchor" href="#安全配置"><span>安全配置</span></a></h3><h4 id="seccomp-系统调用过滤" tabindex="-1"><a class="header-anchor" href="#seccomp-系统调用过滤"><span>Seccomp 系统调用过滤</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxSeccomp <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    DefaultAction LinuxSeccompAction <span class="token comment">// 默认动作</span></span>
<span class="line">    Architectures <span class="token punctuation">[</span><span class="token punctuation">]</span>Arch             <span class="token comment">// 支持的架构</span></span>
<span class="line">    Syscalls      <span class="token punctuation">[</span><span class="token punctuation">]</span>LinuxSyscall     <span class="token comment">// 系统调用规则</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Seccomp 动作类型：</strong></p><ul><li><code>SCMP_ACT_ALLOW</code>: 允许系统调用</li><li><code>SCMP_ACT_ERRNO</code>: 返回错误码</li><li><code>SCMP_ACT_KILL</code>: 终止进程</li><li><code>SCMP_ACT_TRAP</code>: 发送 SIGSYS 信号</li><li><code>SCMP_ACT_NOTIFY</code>: 通知用户空间</li></ul><h4 id="linux-capabilities-能力控制" tabindex="-1"><a class="header-anchor" href="#linux-capabilities-能力控制"><span>Linux Capabilities 能力控制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxCapabilities <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Bounding    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 边界能力集</span></span>
<span class="line">    Effective   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 有效能力集</span></span>
<span class="line">    Inheritable <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 可继承能力集</span></span>
<span class="line">    Permitted   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 允许能力集</span></span>
<span class="line">    Ambient     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 环境能力集</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>常用能力类型：</strong></p><ul><li><code>CAP_NET_ADMIN</code>: 网络管理权限</li><li><code>CAP_SYS_ADMIN</code>: 系统管理权限</li><li><code>CAP_SETUID</code>: 设置用户 ID 权限</li><li><code>CAP_SETGID</code>: 设置组 ID 权限</li></ul><h3 id="设备管理" tabindex="-1"><a class="header-anchor" href="#设备管理"><span>设备管理</span></a></h3><h4 id="设备配置" tabindex="-1"><a class="header-anchor" href="#设备配置"><span>设备配置</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxDevice <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Path     <span class="token builtin">string</span>        <span class="token comment">// 设备在容器中的路径</span></span>
<span class="line">    Type     <span class="token builtin">string</span>        <span class="token comment">// 设备类型 (c, b, u, p)</span></span>
<span class="line">    Major    <span class="token builtin">int64</span>         <span class="token comment">// 主设备号</span></span>
<span class="line">    Minor    <span class="token builtin">int64</span>         <span class="token comment">// 次设备号</span></span>
<span class="line">    FileMode <span class="token operator">*</span>os<span class="token punctuation">.</span>FileMode  <span class="token comment">// 文件权限</span></span>
<span class="line">    UID      <span class="token operator">*</span><span class="token builtin">uint32</span>       <span class="token comment">// 所有者 UID</span></span>
<span class="line">    GID      <span class="token operator">*</span><span class="token builtin">uint32</span>       <span class="token comment">// 所有者 GID</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>必需的默认设备：</strong></p><ul><li><code>/dev/null</code>, <code>/dev/zero</code>, <code>/dev/full</code></li><li><code>/dev/random</code>, <code>/dev/urandom</code></li><li><code>/dev/tty</code>, <code>/dev/console</code>, <code>/dev/ptmx</code></li></ul><h4 id="设备-cgroup-控制" tabindex="-1"><a class="header-anchor" href="#设备-cgroup-控制"><span>设备 Cgroup 控制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> LinuxDeviceCgroup <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Allow  <span class="token builtin">bool</span>    <span class="token comment">// 允许或拒绝</span></span>
<span class="line">    Type   <span class="token builtin">string</span>  <span class="token comment">// 设备类型 (a, c, b)</span></span>
<span class="line">    Major  <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 主设备号</span></span>
<span class="line">    Minor  <span class="token operator">*</span><span class="token builtin">int64</span>  <span class="token comment">// 次设备号</span></span>
<span class="line">    Access <span class="token builtin">string</span>  <span class="token comment">// 访问权限 (rwm)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="挂载配置" tabindex="-1"><a class="header-anchor" href="#挂载配置"><span>挂载配置</span></a></h3><h4 id="挂载点配置" tabindex="-1"><a class="header-anchor" href="#挂载点配置"><span>挂载点配置</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;destination&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;nosuid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noexec&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodev&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Linux 挂载选项：</strong></p><ul><li><strong>基础选项</strong>: <code>bind</code>, <code>rbind</code>, <code>ro</code>, <code>rw</code>, <code>noexec</code>, <code>nosuid</code>, <code>nodev</code></li><li><strong>传播选项</strong>: <code>shared</code>, <code>slave</code>, <code>private</code>, <code>unbindable</code></li><li><strong>ID 映射</strong>: <code>idmap</code>, <code>ridmap</code> (用户命名空间支持)</li></ul><h4 id="必需的默认文件系统" tabindex="-1"><a class="header-anchor" href="#必需的默认文件系统"><span>必需的默认文件系统</span></a></h4><table><thead><tr><th>路径</th><th>类型</th><th>作用</th></tr></thead><tbody><tr><td>/proc</td><td>proc</td><td>进程信息</td></tr><tr><td>/sys</td><td>sysfs</td><td>系统信息</td></tr><tr><td>/dev/pts</td><td>devpts</td><td>伪终端</td></tr><tr><td>/dev/shm</td><td>tmpfs</td><td>共享内存</td></tr></tbody></table><h3 id="hook-系统和生命周期管理" tabindex="-1"><a class="header-anchor" href="#hook-系统和生命周期管理"><span>Hook 系统和生命周期管理</span></a></h3>`,46)),n("blockquote",null,[n("p",null,[s[15]||(s[15]=n("strong",null,"深度解析：",-1)),s[16]||(s[16]=a(" 关于 Hook 系统的详细信息，请参阅 ")),n("strong",null,[p(t,{to:"/blogs/cloud-base/oci-08-hooks-deep-dive.html"},{default:e(()=>s[14]||(s[14]=[a("OCI Hook 系统深度解析")])),_:1,__:[14]})]),s[17]||(s[17]=a("，包含完整的 Hook 类型、执行上下文、标准输入格式和实现示例。"))])]),s[37]||(s[37]=o(`<h4 id="hook-类型" tabindex="-1"><a class="header-anchor" href="#hook-类型"><span>Hook 类型</span></a></h4><ol><li><strong><code>createRuntime</code></strong> - 运行时命名空间，环境创建后</li><li><strong><code>createContainer</code></strong> - 容器命名空间，环境创建后</li><li><strong><code>startContainer</code></strong> - 容器命名空间，用户进程执行前</li><li><strong><code>poststart</code></strong> - 运行时命名空间，用户进程启动后</li><li><strong><code>poststop</code></strong> - 运行时命名空间，容器删除后</li></ol><h4 id="hook-结构" tabindex="-1"><a class="header-anchor" href="#hook-结构"><span>Hook 结构</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> Hook <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Path    <span class="token builtin">string</span>   <span class="token comment">// 可执行文件路径</span></span>
<span class="line">    Args    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 参数</span></span>
<span class="line">    Env     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// 环境变量</span></span>
<span class="line">    Timeout <span class="token operator">*</span><span class="token builtin">int</span>     <span class="token comment">// 超时时间 (秒)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行时接口" tabindex="-1"><a class="header-anchor" href="#运行时接口"><span>运行时接口</span></a></h3><h4 id="容器状态" tabindex="-1"><a class="header-anchor" href="#容器状态"><span>容器状态</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ociVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;container-id&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;running&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/bundle&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行时操作" tabindex="-1"><a class="header-anchor" href="#运行时操作"><span>运行时操作</span></a></h4><ul><li><code>create &lt;container-id&gt;</code> - 创建容器</li><li><code>start &lt;container-id&gt;</code> - 启动容器进程</li><li><code>kill &lt;container-id&gt; &lt;signal&gt;</code> - 发送信号给容器</li><li><code>delete &lt;container-id&gt;</code> - 删除容器</li><li><code>state &lt;container-id&gt;</code> - 查询容器状态</li></ul><h2 id="实际配置示例" tabindex="-1"><a class="header-anchor" href="#实际配置示例"><span>实际配置示例</span></a></h2><h3 id="基础容器配置" tabindex="-1"><a class="header-anchor" href="#基础容器配置"><span>基础容器配置</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ociVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;process&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;terminal&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;gid&quot;</span><span class="token operator">:</span> <span class="token number">1000</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;PATH=/usr/local/bin:/usr/bin:/bin&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;TERM=xterm&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;capabilities&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;effective&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CAP_CHOWN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;bounding&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CAP_CHOWN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;inheritable&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;permitted&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CAP_CHOWN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;ambient&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;noNewPrivileges&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rootfs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;readonly&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mycontainer&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;mounts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;destination&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;nosuid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noexec&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodev&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;destination&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sys&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sysfs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sysfs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;nosuid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noexec&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodev&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ro&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;namespaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pid&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;network&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ipc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uts&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mount&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;uidMappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;containerID&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;hostID&quot;</span><span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;gidMappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;containerID&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;hostID&quot;</span><span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;memory&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">134217728</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;swappiness&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;cpu&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;shares&quot;</span><span class="token operator">:</span> <span class="token number">512</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;quota&quot;</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;period&quot;</span><span class="token operator">:</span> <span class="token number">100000</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="高安全容器配置" tabindex="-1"><a class="header-anchor" href="#高安全容器配置"><span>高安全容器配置</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ociVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;process&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;terminal&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;gid&quot;</span><span class="token operator">:</span> <span class="token number">1000</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/local/bin/app&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PATH=/usr/local/bin:/usr/bin:/bin&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/app&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;capabilities&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;effective&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;bounding&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;inheritable&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;permitted&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;ambient&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;noNewPrivileges&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;oomScoreAdj&quot;</span><span class="token operator">:</span> <span class="token number">100</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;seccomp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;defaultAction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;architectures&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;SCMP_ARCH_X86_64&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;syscalls&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                        <span class="token string">&quot;brk&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exit_group&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;futex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token string">&quot;mmap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;munmap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rt_sigaction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rt_sigprocmask&quot;</span></span>
<span class="line">                    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ALLOW&quot;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;maskedPaths&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;/proc/acpi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/kcore&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/keys&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;/proc/latency_stats&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/timer_list&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;/proc/timer_stats&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/sched_debug&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;/proc/scsi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/sys/firmware&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;readonlyPaths&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;/proc/asound&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/bus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/fs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;/proc/irq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/sys&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/sysrq-trigger&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><h3 id="安全配置建议" tabindex="-1"><a class="header-anchor" href="#安全配置建议"><span>安全配置建议</span></a></h3><ol><li><p><strong>最小权限原则</strong></p><ul><li>移除不必要的 capabilities</li><li>设置 <code>noNewPrivileges: true</code></li><li>使用非 root 用户运行</li></ul></li><li><p><strong>资源限制</strong></p><ul><li>设置合理的内存和 CPU 限制</li><li>配置 I/O 带宽限制</li><li>限制进程数量</li></ul></li><li><p><strong>文件系统保护</strong></p><ul><li>使用只读根文件系统</li><li>隐藏敏感的 /proc 和 /sys 路径</li><li>配置适当的挂载选项</li></ul></li></ol><h3 id="性能优化" tabindex="-1"><a class="header-anchor" href="#性能优化"><span>性能优化</span></a></h3><ol><li><p><strong>CPU 配置</strong></p><ul><li>根据应用特性设置 CPU shares</li><li>使用 CPU 集合绑定</li><li>配置适当的调度策略</li></ul></li><li><p><strong>内存管理</strong></p><ul><li>设置内存预留避免竞争</li><li>禁用 swap 保证性能一致性</li><li>监控内存使用模式</li></ul></li></ol><h2 id="下一步学习" tabindex="-1"><a class="header-anchor" href="#下一步学习"><span>下一步学习</span></a></h2><p>完成 Runtime 规范学习后，建议继续学习：</p>`,21)),n("ol",null,[n("li",null,[n("strong",null,[p(t,{to:"/blogs/cloud-base/oci-03-image-spec.html"},{default:e(()=>s[18]||(s[18]=[a("OCI Image 规范详解")])),_:1,__:[18]})]),s[19]||(s[19]=a(" - 了解镜像格式和构建"))]),n("li",null,[n("strong",null,[p(t,{to:"/blogs/cloud-base/oci-05-security-guide.html"},{default:e(()=>s[20]||(s[20]=[a("OCI 容器安全配置实战")])),_:1,__:[20]})]),s[21]||(s[21]=a(" - 深入安全配置实践"))]),n("li",null,[n("strong",null,[p(t,{to:"/blogs/cloud-base/oci-06-monitoring-guide.html"},{default:e(()=>s[22]||(s[22]=[a("OCI 容器监控调试与故障排除")])),_:1,__:[22]})]),s[23]||(s[23]=a(" - 掌握运维技能"))])]),s[38]||(s[38]=n("h2",{id:"总结",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#总结"},[n("span",null,"总结")])],-1)),s[39]||(s[39]=n("p",null,"OCI Runtime 规范为 Linux 容器提供了全面的配置框架，通过深入理解命名空间、Cgroups、安全配置等核心概念，您可以构建更安全、高效的容器化应用。",-1)),s[40]||(s[40]=n("p",null,[n("strong",null,"关键要点：")],-1)),s[41]||(s[41]=n("ul",null,[n("li",null,"Runtime 规范定义了容器的运行时行为"),n("li",null,"Linux 专用配置涵盖了内核的各种特性"),n("li",null,"安全配置是容器部署的重要考虑因素"),n("li",null,"合理的资源限制能确保系统稳定性")],-1)),s[42]||(s[42]=n("hr",null,null,-1)),n("p",null,[s[27]||(s[27]=n("strong",null,"上一篇：",-1)),s[28]||(s[28]=a()),p(t,{to:"/blogs/cloud-base/oci-01-intro-guide.html"},{default:e(()=>s[24]||(s[24]=[a("OCI 容器技术入门指南")])),_:1,__:[24]}),s[29]||(s[29]=n("br",null,null,-1)),s[30]||(s[30]=n("strong",null,"下一篇：",-1)),s[31]||(s[31]=a()),p(t,{to:"/blogs/cloud-base/oci-03-image-spec.html"},{default:e(()=>s[25]||(s[25]=[a("OCI Image 规范详解 - 容器镜像格式与构建")])),_:1,__:[25]}),s[32]||(s[32]=n("br",null,null,-1)),s[33]||(s[33]=n("strong",null,"返回：",-1)),s[34]||(s[34]=a()),p(t,{to:"/blogs/cloud-base/oci-series-index.html"},{default:e(()=>s[26]||(s[26]=[a("OCI 容器技术完全指南系列")])),_:1,__:[26]})])])}const q=c(d,[["render",v]]),g=JSON.parse('{"path":"/blogs/cloud-base/oci-02-runtime-spec.html","title":"OCI Runtime 规范详解 - Linux 容器配置完全指南","lang":"en-US","frontmatter":{"categories":["cloud-base"]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"核心配置结构","slug":"核心配置结构","link":"#核心配置结构","children":[{"level":3,"title":"配置字段说明","slug":"配置字段说明","link":"#配置字段说明","children":[]}]},{"level":2,"title":"Linux 专用配置","slug":"linux-专用配置","link":"#linux-专用配置","children":[{"level":3,"title":"命名空间隔离","slug":"命名空间隔离","link":"#命名空间隔离","children":[]},{"level":3,"title":"资源管理 (Cgroups)","slug":"资源管理-cgroups","link":"#资源管理-cgroups","children":[]},{"level":3,"title":"安全配置","slug":"安全配置","link":"#安全配置","children":[]},{"level":3,"title":"设备管理","slug":"设备管理","link":"#设备管理","children":[]},{"level":3,"title":"挂载配置","slug":"挂载配置","link":"#挂载配置","children":[]},{"level":3,"title":"Hook 系统和生命周期管理","slug":"hook-系统和生命周期管理","link":"#hook-系统和生命周期管理","children":[]},{"level":3,"title":"运行时接口","slug":"运行时接口","link":"#运行时接口","children":[]}]},{"level":2,"title":"实际配置示例","slug":"实际配置示例","link":"#实际配置示例","children":[{"level":3,"title":"基础容器配置","slug":"基础容器配置","link":"#基础容器配置","children":[]},{"level":3,"title":"高安全容器配置","slug":"高安全容器配置","link":"#高安全容器配置","children":[]}]},{"level":2,"title":"最佳实践","slug":"最佳实践","link":"#最佳实践","children":[{"level":3,"title":"安全配置建议","slug":"安全配置建议","link":"#安全配置建议","children":[]},{"level":3,"title":"性能优化","slug":"性能优化","link":"#性能优化","children":[]}]},{"level":2,"title":"下一步学习","slug":"下一步学习","link":"#下一步学习","children":[]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1754503646000,"updatedTime":1754503646000,"contributors":[{"name":"hushengnian","email":"hushengnian@example.com","commits":1}]},"filePathRelative":"blogs/cloud-base/oci-02-runtime-spec.md"}');export{q as comp,g as data};
