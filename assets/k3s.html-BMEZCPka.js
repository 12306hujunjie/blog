import{_ as o,c as i,d as s,a as t,e as n,b as l,r as a,o as d}from"./app--xDOKwpD.js";const p={},c={href:"https://docs.rancher.cn/docs/k3s/advanced/_index/#%E5%9C%A8-raspbian-buster-%E4%B8%8A%E5%90%AF%E7%94%A8%E6%97%A7%E7%89%88%E7%9A%84-iptables",target:"_blank",rel:"noopener noreferrer"},h={href:"https://docs.rancher.cn/docs/k3s/advanced/_index#alpine-linux-%E5%AE%89%E8%A3%85%E7%9A%84%E9%A2%9D%E5%A4%96%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C",target:"_blank",rel:"noopener noreferrer"},g={href:"https://docs.rancher.cn/docs/k3s/advanced/_index#Red-Hat-%E5%92%8C-CentOS-%E7%9A%84%E9%A2%9D%E5%A4%96%E5%87%86%E5%A4%87",target:"_blank",rel:"noopener noreferrer"},x={href:"https://docs.rancher.cn/docs/k3s/installation/ha/_index",target:"_blank",rel:"noopener noreferrer"};function u(k,e){const r=a("ExternalLinkIcon");return d(),i("div",null,[e[14]||(e[14]=s('<h2 id="ä¸€ã€å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‡†å¤‡å·¥ä½œ"><span>ä¸€ã€å‡†å¤‡å·¥ä½œ</span></a></h2><h3 id="_1-å…ˆå†³æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-å…ˆå†³æ¡ä»¶"><span>1. å…ˆå†³æ¡ä»¶</span></a></h3><p>ä¸¤ä¸ªèŠ‚ç‚¹ä¸èƒ½æœ‰ç›¸åŒçš„ä¸»æœºåã€‚å¦‚æœæ‚¨çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„ä¸»æœºåï¼Œè¯·ä½¿ç”¨--with-node-idé€‰é¡¹ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªéšæœºåç¼€ï¼Œæˆ–è€…ä¸ºæ‚¨æ·»åŠ åˆ°é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è®¾è®¡ä¸€ä¸ªç‹¬ç‰¹çš„åç§°ï¼Œç”¨--node-nameæˆ–$K3S_NODE_NAMEä¼ é€’ã€‚<br> å»ºè®®åœ¨ä¸€å¼€å§‹è®¾ç½®å¥½æ‰€æœ‰èŠ‚ç‚¹çš„hostname,å¦‚<code>hostnamectl set-hostname master-node1</code></p><h3 id="_2-æ“ä½œç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_2-æ“ä½œç³»ç»Ÿ"><span>2. æ“ä½œç³»ç»Ÿ</span></a></h3><p>K3s æœ‰æœ›åœ¨å¤§å¤šæ•°ç°ä»£ Linux ç³»ç»Ÿä¸Šè¿è¡Œã€‚</p><p>æœ‰äº›æ“ä½œç³»ç»Ÿæœ‰ç‰¹å®šè¦æ±‚ï¼š</p>',6)),t("ul",null,[t("li",null,[e[1]||(e[1]=n("å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Raspbian Busterï¼Œè¯·æŒ‰ç…§")),t("a",c,[e[0]||(e[0]=n("è¿™äº›æ­¥éª¤")),l(r)]),e[2]||(e[2]=n("åˆ‡æ¢åˆ°ä¼ ç»Ÿçš„ iptablesã€‚"))]),t("li",null,[e[4]||(e[4]=n("å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Alpine Linuxï¼Œè¯·æŒ‰ç…§")),t("a",h,[e[3]||(e[3]=n("è¿™äº›æ­¥éª¤")),l(r)]),e[5]||(e[5]=n("è¿›è¡Œé¢å¤–è®¾ç½®ã€‚"))]),t("li",null,[e[7]||(e[7]=n("å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Red Hat/CentOSï¼Œè¯·æŒ‰ç…§")),t("a",g,[e[6]||(e[6]=n("è¿™äº›æ­¥éª¤")),l(r)]),e[8]||(e[8]=n("è¿›è¡Œé¢å¤–è®¾ç½®ã€‚"))])]),e[15]||(e[15]=s('<h3 id="_3-cpu-å†…å­˜å’Œç£ç›˜" tabindex="-1"><a class="header-anchor" href="#_3-cpu-å†…å­˜å’Œç£ç›˜"><span>3. CPU,å†…å­˜å’Œç£ç›˜</span></a></h3><p>æœ€ä½è¦æ±‚<code>1c1g</code>çš„cpuå’Œå†…å­˜<br> ç£ç›˜çš„æ€§èƒ½å†³å®šäº†<code>k3s</code>çš„æ€§èƒ½,å»ºè®®ä½¿ç”¨ssd</p><h3 id="_4-ç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#_4-ç½‘ç»œ"><span>4. ç½‘ç»œ</span></a></h3><p>K3s server éœ€è¦ 6443 ç«¯å£æ‰èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è®¿é—®ã€‚</p><p>å½“ä½¿ç”¨ Flannel VXLAN æ—¶ï¼ŒèŠ‚ç‚¹éœ€è¦èƒ½å¤Ÿé€šè¿‡ UDP ç«¯å£ 8472 è®¿é—®å…¶ä»–èŠ‚ç‚¹ã€‚èŠ‚ç‚¹ä¸åº”è¯¥åœ¨å…¶ä»–ç«¯å£ä¸Šç›‘å¬ã€‚K3s ä½¿ç”¨åå‘éš§é“ï¼Œè¿™æ ·èŠ‚ç‚¹ä¸æœåŠ¡å™¨å»ºç«‹å‡ºç«™è¿æ¥ï¼Œæ‰€æœ‰çš„ kubelet æµé‡éƒ½é€šè¿‡è¯¥éš§é“è¿è¡Œã€‚ç„¶è€Œï¼Œå¦‚æœä½ ä¸ä½¿ç”¨ Flannel å¹¶æä¾›è‡ªå·±çš„è‡ªå®šä¹‰ CNIï¼Œé‚£ä¹ˆ K3s å°±ä¸éœ€è¦ 8472 ç«¯å£ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨metrics serverï¼Œåˆ™éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰“å¼€ç«¯å£ 10250 ç«¯å£ã€‚</p><p>å¦‚æœè®¡åˆ’ä½¿ç”¨åµŒå…¥å¼ etcd å®ç°é«˜å¯ç”¨æ€§ï¼Œåˆ™ server èŠ‚ç‚¹å¿…é¡»åœ¨ç«¯å£ 2379 å’Œ 2380 ä¸Šå¯ä»¥ç›¸äº’è®¿é—®ã€‚</p><div class="custom-container tip"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">TIP</p><p>èŠ‚ç‚¹ä¸Šçš„ VXLAN ç«¯å£ä¸åº”å…¬å¼€æš´éœ²ï¼Œå› ä¸ºå®ƒå…¬å¼€äº†é›†ç¾¤ç½‘ç»œï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®å®ƒã€‚åº”åœ¨ç¦æ­¢è®¿é—®ç«¯å£ 8472 çš„é˜²ç«å¢™/å®‰å…¨ç»„åé¢è¿è¡ŒèŠ‚ç‚¹ã€‚</p></div><div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">WARNING</p><p>Flannel ä¾é  Bridge CNI plugin æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥äº¤æ¢æµé‡çš„ L2 ç½‘ç»œã€‚å…·æœ‰ NET_RAW åŠŸèƒ½çš„ Rogue pod å¯ä»¥æ»¥ç”¨è¯¥ L2 ç½‘ç»œæ¥å‘åŠ¨æ”»å‡»ï¼Œå¦‚ ARP æ¬ºéª—ã€‚å› æ­¤ï¼Œæ­£å¦‚ kubernetes æ–‡æ¡£ä¸­è®°è½½çš„é‚£æ ·ï¼Œè¯·è®¾ç½®ä¸€ä¸ªå—é™é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸å¯ä¿¡ä»»çš„ pod ä¸Šç¦ç”¨ NET_RAWã€‚</p></div><table><thead><tr><th style="text-align:center;">åè®®</th><th style="text-align:center;">ç«¯å£</th><th style="text-align:center;">æº</th><th style="text-align:center;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">6443</td><td style="text-align:center;">K3s agent èŠ‚ç‚¹</td><td style="text-align:center;">Kubernetes API Server</td></tr><tr><td style="text-align:center;">UDP</td><td style="text-align:center;">8472</td><td style="text-align:center;">K3s server å’Œ agent èŠ‚ç‚¹</td><td style="text-align:center;">ä»…å¯¹ Flannel VXLAN éœ€è¦</td></tr><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">10250</td><td style="text-align:center;">K3s server å’Œ agent èŠ‚ç‚¹</td><td style="text-align:center;">Kubelet metrics</td></tr><tr><td style="text-align:center;">TCP</td><td style="text-align:center;">2379-2380</td><td style="text-align:center;">K3s server èŠ‚ç‚¹</td><td style="text-align:center;">åªæœ‰åµŒå…¥å¼ etcd é«˜å¯ç”¨æ‰éœ€è¦</td></tr></tbody></table><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å‡ºç«™æµé‡éƒ½æ˜¯å…è®¸çš„ã€‚</p><h2 id="äºŒã€å¿«é€Ÿå®‰è£…" tabindex="-1"><a class="header-anchor" href="#äºŒã€å¿«é€Ÿå®‰è£…"><span>äºŒã€å¿«é€Ÿå®‰è£…</span></a></h2><ol><li>server å›½å†…å®‰è£…<br><code>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -</code></li><li>server å›½å¤–å®‰è£…<br><code>curl -sfL https://get.k3s.io | sh -</code></li><li>worker å›½å†…å®‰è£…<br><code>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=${K3S_URL} K3S_TOKEN=${K3S_TOKEN} sh -</code></li><li>worker å›½å¤–å®‰è£…<br><code>curl -sfL https://get.k3s.io | K3S_URL=${K3S_URL} K3S_TOKEN=${K3S_TOKEN} sh -</code></li></ol><p><strong>notice</strong>:</p>',14)),t("ul",null,[e[12]||(e[12]=s("<li><p>worker å®‰è£…å‰å…ˆexportä¸€ä¸‹ç¯å¢ƒå˜é‡<br><code>export K3S_URL=https://{ip or domain}:6443</code><br> ps: æ­¤å¤„è‹¥æƒ³è¦api serveré«˜å¯ç”¨ï¼Œå¯æœ‰ä¸‰ç§æ–¹å¼</p><ol><li>è´­ä¹°å†…ç½‘è´Ÿè½½å‡è¡¡è§£æåˆ°ç›¸å…³serverèŠ‚ç‚¹ç«¯å£</li><li>DNSè´Ÿè½½å‡è¡¡è§£æ</li><li>VIPæˆ–è€…å¼¹æ€§ip <code>export K3S_TOKEN=xxxxx::server:xxxxx</code></li></ol></li><li><p><code>K3S_TOKEN</code> åœ¨serverç¯å¢ƒçš„<code>/var/lib/rancher/k3s/server/node-token</code>è·¯å¾„</p></li><li><p>æ¯å°è®¡ç®—æœºå¿…é¡»å…·æœ‰å”¯ä¸€çš„ä¸»æœºåã€‚å¦‚æœæ‚¨çš„è®¡ç®—æœºæ²¡æœ‰å”¯ä¸€çš„ä¸»æœºåï¼Œè¯·ä¼ é€’<code>K3S_NODE_NAME</code>ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹æä¾›ä¸€ä¸ªæœ‰æ•ˆä¸”å”¯ä¸€çš„ä¸»æœºåã€‚</p></li>",3)),t("li",null,[t("p",null,[t("a",x,[e[9]||(e[9]=n("é«˜å¯ç”¨å®‰è£…")),l(r)]),e[10]||(e[10]=n("æ—¶å¯ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ ")),e[11]||(e[11]=t("code",null,"--datastore-endpoint='mysql://user:pass@tcp(url:port)/database'",-1))])]),e[13]||(e[13]=t("li",null,[t("p",null,[n("ç”±äºk3sv2ä¹‹åå¼ºåˆ¶å®‰è£…çš„traefikä¹Ÿå‡çº§åˆ°v2ç‰ˆæœ¬ï¼Œä¸å½“å‰nginx ingressé…ç½®å®Œå…¨ä¸å…¼å®¹ï¼Œæœ¬æ¬¡é€‰ç”¨æŒ‡å®šç‰ˆæœ¬, å®‰è£…å‰exportä¸€ä¸‹ç¯å¢ƒå˜é‡"),t("code",null,"INSTALL_K3S_VERSION=v1.19.16+k3s1")])],-1))]),e[16]||(e[16]=t("p",null,"è‡³æ­¤å°±å®Œæˆäº†ğŸ‰",-1))])}const b=o(p,[["render",u]]),E=JSON.parse('{"path":"/blogs/cloud-base/k3s.html","title":"k3s(è½»é‡çº§k8s)éƒ¨ç½²","lang":"en-US","frontmatter":{"title":"k3s(è½»é‡çº§k8s)éƒ¨ç½²","date":"2022-01-03T00:00:00.000Z","tags":["kubernetes","k3s","äº‘åŸç”Ÿ","å®¹å™¨ç¼–æ’","è¿ç»´","éƒ¨ç½²","ä¸­çº§","ç”Ÿäº§ç¯å¢ƒ"],"categories":["cloud-base"],"sidebar":"auto"},"headers":[{"level":2,"title":"ä¸€ã€å‡†å¤‡å·¥ä½œ","slug":"ä¸€ã€å‡†å¤‡å·¥ä½œ","link":"#ä¸€ã€å‡†å¤‡å·¥ä½œ","children":[{"level":3,"title":"1. å…ˆå†³æ¡ä»¶","slug":"_1-å…ˆå†³æ¡ä»¶","link":"#_1-å…ˆå†³æ¡ä»¶","children":[]},{"level":3,"title":"2. æ“ä½œç³»ç»Ÿ","slug":"_2-æ“ä½œç³»ç»Ÿ","link":"#_2-æ“ä½œç³»ç»Ÿ","children":[]},{"level":3,"title":"3. CPU,å†…å­˜å’Œç£ç›˜","slug":"_3-cpu-å†…å­˜å’Œç£ç›˜","link":"#_3-cpu-å†…å­˜å’Œç£ç›˜","children":[]},{"level":3,"title":"4. ç½‘ç»œ","slug":"_4-ç½‘ç»œ","link":"#_4-ç½‘ç»œ","children":[]}]},{"level":2,"title":"äºŒã€å¿«é€Ÿå®‰è£…","slug":"äºŒã€å¿«é€Ÿå®‰è£…","link":"#äºŒã€å¿«é€Ÿå®‰è£…","children":[]}],"git":{"createdTime":1752125632000,"updatedTime":1752125632000,"contributors":[{"name":"æˆ·ç››å¹´","email":"hushengnian@hushengniandeMacBook-Air.local","commits":1}]},"filePathRelative":"blogs/cloud-base/k3s.md"}');export{b as comp,E as data};
