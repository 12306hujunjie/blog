<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js" as="script"><title>容器生命周期管理 | database of memory</title><meta name="description" content="study anything and life record">
    <link rel="preload" href="/blog/assets/style-3Js8NCR5.css" as="style"><link rel="stylesheet" href="/blog/assets/style-3Js8NCR5.css">
    <link rel="modulepreload" href="/blog/assets/app-6X7aTgdN.js"><link rel="modulepreload" href="/blog/assets/02-rongqishengmingzhouqiguanli.html-0v7Ls9cX.js">
    <link rel="prefetch" href="/blog/assets/timeline.html-DqGpz6zD.js" as="script"><link rel="prefetch" href="/blog/assets/posts.html-D7Bvy0d7.js" as="script"><link rel="prefetch" href="/blog/assets/friendship-link.html-BeuJvd9N.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Chuj08UQ.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CAiUFWts.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-D37ih9Uu.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-B7r5o5tl.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Bk-Ur-c2.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BoqA-Ln0.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CePHWKeW.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DrJSOmlA.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-U1rZfE85.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CTD9OTnI.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-ClxupEHP.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-qlkAfAwM.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Bcv-xUWV.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-k8qqQK3e.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-CDYIBSbu.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C9Nfp7Ay.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CjHzGOJ-.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CYNCZ_rK.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BcBA7pf2.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Bs4xEXI5.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-M__IdVLb.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BH3X1mh_.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BHb1grF4.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Brifmhtt.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-qwpDWejy.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C1gJL2lV.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-U6_-H0Sh.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-LhfHHy5S.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C-LkskE-.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DmhkJd-t.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BCtbHwdB.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DiSqFikV.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Ggy9-9RW.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DHzX2MiW.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Y_MjXMva.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Dfh-jUGd.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Dj3i--SL.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-jFYTncAL.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CEVzFokr.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CQO4krTi.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-kJCQem_o.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CptdwrQ-.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BZ8F9Q78.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CO2Lqb20.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-B3vfuGqd.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D0Hq0dy6.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BaR09h1V.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-B0dHEN0C.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DxeVe2QE.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-B-kJe58I.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-bmqWX6zb.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BebdTN1L.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BwMJ76N1.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CTduS54Q.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Dcc4oMtL.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Cuqf1HeB.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D7mC1WDN.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-v6nZ1ZWL.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BPZMg7Ne.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DxoNufPU.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BZBwiKs9.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C_-Xixh1.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BnQNYAZB.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BE0yJYJV.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CEWENM8H.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-XtMtCj0R.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CrwupWzR.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CWANwt8I.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-0cS3PG1a.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-SjppBNSL.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CHykDJHD.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Dtk_YvDI.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-fpyujYmI.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BFxeIDyb.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CKHvNVKM.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DIUFuATR.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BtIyxRUq.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D4v3h6Vg.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-FIb6d2j_.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BaLNiMq6.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Bdo9dHNd.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-1AGwP5Te.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CKMLoDjE.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BJHQObic.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BCpqeqgO.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-jC2ZrfN-.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-vWaMPMS8.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BEVoBKhp.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Do1Zlsl6.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CPVc_dd4.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DWViIrax.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-RQjr3Fnf.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-dD1j4CIg.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-CS7SB9DU.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-ft_1EMsZ.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-QiRa9oJ7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BAQynWuW.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KC4P4b0V.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BE8vwrI8.js" as="script"><link rel="prefetch" href="/blog/assets/bitwise_operation.html-CGQUwYxj.js" as="script"><link rel="prefetch" href="/blog/assets/learning_algorithm.html-DI9nJoC0.js" as="script"><link rel="prefetch" href="/blog/assets/cache_pattern.html-Dl3pGg-V.js" as="script"><link rel="prefetch" href="/blog/assets/docker_tech.html-C6Pxm_Pq.js" as="script"><link rel="prefetch" href="/blog/assets/k3s.html-SJowENbd.js" as="script"><link rel="prefetch" href="/blog/assets/k3s_k8s_ingress.html-BLEzHFNF.js" as="script"><link rel="prefetch" href="/blog/assets/oci-01-intro-guide.html-DPFVTs4y.js" as="script"><link rel="prefetch" href="/blog/assets/oci-02-runtime-spec.html-qS0CXXyx.js" as="script"><link rel="prefetch" href="/blog/assets/oci-03-image-spec.html-TDvk0Tea.js" as="script"><link rel="prefetch" href="/blog/assets/oci-04-distribution-spec.html-6IAzcDD0.js" as="script"><link rel="prefetch" href="/blog/assets/oci-05-security-guide.html-Cc6Cssbq.js" as="script"><link rel="prefetch" href="/blog/assets/oci-06-monitoring-guide.html-CvtfFvF0.js" as="script"><link rel="prefetch" href="/blog/assets/oci-07-production-guide.html-n2TaAX2U.js" as="script"><link rel="prefetch" href="/blog/assets/oci-08-hooks-deep-dive.html-C7B2kQ6J.js" as="script"><link rel="prefetch" href="/blog/assets/oci-linux-configurations-blog.html-DwrOQxhi.js" as="script"><link rel="prefetch" href="/blog/assets/oci-series-index.html-DRCITB_S.js" as="script"><link rel="prefetch" href="/blog/assets/runc-container-lifecycle-diagrams.html-BAc1MNwt.js" as="script"><link rel="prefetch" href="/blog/assets/linux_namespace.html-jiIEKnFi.js" as="script"><link rel="prefetch" href="/blog/assets/python_checklist.html-s6uOrY8u.js" as="script"><link rel="prefetch" href="/blog/assets/python_env_manage.html-BSV_lFtV.js" as="script"><link rel="prefetch" href="/blog/assets/gevent.html-CA1arPDM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DkNYT3Zm.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D9psQpTb.js" as="script"><link rel="prefetch" href="/blog/assets/fullstack.html-Dv-FNS3q.js" as="script"><link rel="prefetch" href="/blog/assets/sort_1.html-W70lVzfg.js" as="script"><link rel="prefetch" href="/blog/assets/01-runcgaishuyujiagou.html-QDM-MnSj.js" as="script"><link rel="prefetch" href="/blog/assets/03-Namespacegelishixian.html-Dg1Vp7rK.js" as="script"><link rel="prefetch" href="/blog/assets/04-Cgroupsziyuanguanli.html-BgjFfgpp.js" as="script"><link rel="prefetch" href="/blog/assets/05-wenjianxitongyuguazaiguanli.html-CqMH5NWU.js" as="script"><link rel="prefetch" href="/blog/assets/06-anquantexingshixian.html-CVCalXw5.js" as="script"><link rel="prefetch" href="/blog/assets/07-CRIUjianchadianyuhuifu.html-DliOwtSW.js" as="script"><link rel="prefetch" href="/blog/assets/08-tongxinyujiankongxitong.html-CGPnknuZ.js" as="script"><link rel="prefetch" href="/blog/assets/09-goujianjianhuarongqiyunxingshi.html-CpW0Ergx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CEju9IkR.js" as="script"><link rel="prefetch" href="/blog/assets/python-async-mastery.html-CSosiE7a.js" as="script"><link rel="prefetch" href="/blog/assets/abstract_factory.html-CUp2rgGA.js" as="script"><link rel="prefetch" href="/blog/assets/factory_method.html-COdBv8o2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cpj7w3BK.js" as="script"><link rel="prefetch" href="/blog/assets/adapter.html-BkNp5Tfd.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-hxa3gNLp.js" as="script"><link rel="prefetch" href="/blog/assets/Valine.min-VCLvSWzF.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-aTimukGI-DWEKOTfS.js" as="script"><link rel="prefetch" href="/blog/assets/KnowledgeMap-CVNiRhtZ.js" as="script"><link rel="prefetch" href="/blog/assets/MermaidChart-z8ABlZRz.js" as="script"><link rel="prefetch" href="/blog/assets/mermaid.core-9NKgZvfC.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/blog/logo.png" alt="database of memory"><a href="/blog/" class="site-name can-hide">database of memory</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/blog/" class="link" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/blog/categories/cloud-base/1/" class="link" aria-label="Categories"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Categories<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/blog/tags/runc/1/" class="link" aria-label="Tags"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Tags<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/blog/knowledge-map/" class="link" aria-label="知识地图"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->知识地图<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Docs"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docs<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Docs"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docs<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog/docs/leetcode/" class="link" aria-label="leetcode from scratch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->leetcode from scratch<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/docs/design_pattern/" class="link" aria-label="design pattern"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->design pattern<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">容器生命周期管理</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->hujunjie<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025-08-02<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/categories/cloud-base/runc-deep-dive/1.html" class="">cloud-base/runc-deep-dive</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/tags/runc/1.html" class="">runc</a><a href="/blog/tags/yunyuansheng/1.html" class="">云原生</a><a href="/blog/tags/shengmingzhouqi/1.html" class="">生命周期</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h1 id="容器生命周期管理" tabindex="-1"><a class="header-anchor" href="#容器生命周期管理"><span>容器生命周期管理</span></a></h1><blockquote><p><strong>系列导航：</strong> <a class="route-link" href="/blog/blogs/cloud-base/runc-deep-dive/">runc 容器运行时深度解析系列</a> → 第二篇：容器生命周期管理<br><strong>上一篇：</strong> <a class="route-link" href="/blog/blogs/cloud-base/runc-deep-dive/01-runcgaishuyujiagou.html">runc概述与架构</a><br><strong>最后更新：</strong> 2024</p></blockquote><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>容器生命周期管理是 runc 的核心功能，包括容器的创建、启动、暂停、恢复、停止和删除等操作。本文深入分析 runc 如何管理容器状态转换、进程同步以及状态持久化机制。</p><h2 id="容器状态模型" tabindex="-1"><a class="header-anchor" href="#容器状态模型"><span>容器状态模型</span></a></h2><h3 id="_1-1-四种基本状态" tabindex="-1"><a class="header-anchor" href="#_1-1-四种基本状态"><span>1.1 四种基本状态</span></a></h3><p>runc 定义了四种容器状态，这些状态反映了容器在其生命周期中的不同阶段：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/container.go:17</span></span>
<span class="line"><span class="token keyword">type</span> Status <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token comment">// Created: 容器已创建但尚未运行</span></span>
<span class="line">    Created Status <span class="token operator">=</span> <span class="token boolean">iota</span></span>
<span class="line">    <span class="token comment">// Running: 容器正在运行</span></span>
<span class="line">    Running</span>
<span class="line">    <span class="token comment">// Paused: 容器存在，但所有进程都被暂停</span></span>
<span class="line">    Paused</span>
<span class="line">    <span class="token comment">// Stopped: 容器没有运行的进程</span></span>
<span class="line">    Stopped</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-状态详细说明" tabindex="-1"><a class="header-anchor" href="#_1-2-状态详细说明"><span>1.2 状态详细说明</span></a></h3><table><thead><tr><th>状态</th><th>含义</th><th>特征</th><th>典型触发</th></tr></thead><tbody><tr><td><strong>Created</strong></td><td>容器已创建但初始化进程未启动</td><td>- 配置已加载<br>- 资源已分配<br>- 进程未执行</td><td><code>runc create</code></td></tr><tr><td><strong>Running</strong></td><td>容器正常运行</td><td>- 初始化进程正在执行<br>- 所有资源可用<br>- 可以接收信号</td><td><code>runc start</code><br><code>runc run</code></td></tr><tr><td><strong>Paused</strong></td><td>容器进程被冻结</td><td>- 进程存在但被挂起<br>- 内存状态保持<br>- 不消耗 CPU</td><td><code>runc pause</code></td></tr><tr><td><strong>Stopped</strong></td><td>容器已停止</td><td>- 没有运行的进程<br>- 资源可能仍被占用<br>- 可以被删除</td><td>进程退出<br><code>runc kill</code></td></tr></tbody></table><h3 id="_1-3-状态转换图" tabindex="-1"><a class="header-anchor" href="#_1-3-状态转换图"><span>1.3 状态转换图</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">    [容器不存在]</span>
<span class="line">          │</span>
<span class="line">          │ runc create</span>
<span class="line">          ▼</span>
<span class="line">    ┌──────────┐     runc start     ┌─────────┐</span>
<span class="line">    │ Created  │ ──────────────────▶│ Running │</span>
<span class="line">    └─────┬────┘                    └────┬────┘</span>
<span class="line">          │                              │</span>
<span class="line">          │ runc delete                  │ runc pause</span>
<span class="line">          │ (force)                      ▼</span>
<span class="line">          │                         ┌─────────┐</span>
<span class="line">          │                         │ Paused  │</span>
<span class="line">          │                         └────┬────┘</span>
<span class="line">          │                              │</span>
<span class="line">          │                              │ runc resume</span>
<span class="line">          │                              │</span>
<span class="line">          ▼                              ▼</span>
<span class="line">    ┌──────────┐    runc delete     ┌─────────┐</span>
<span class="line">    │ Stopped  │◀───────────────────│ Running │</span>
<span class="line">    └─────┬────┘                    └─────────┘</span>
<span class="line">          │                              ▲</span>
<span class="line">          │ 进程退出 / runc kill           │</span>
<span class="line">          └───────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-状态管理实现" tabindex="-1"><a class="header-anchor" href="#_2-状态管理实现"><span>2. 状态管理实现</span></a></h2><h3 id="_2-1-状态机接口" tabindex="-1"><a class="header-anchor" href="#_2-1-状态机接口"><span>2.1 状态机接口</span></a></h3><p>runc 使用状态机模式来管理容器状态：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/state_linux.go</span></span>
<span class="line"><span class="token keyword">type</span> containerState <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">transition</span><span class="token punctuation">(</span>containerState<span class="token punctuation">)</span> <span class="token builtin">error</span>  <span class="token comment">// 状态转换</span></span>
<span class="line">    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>                   <span class="token comment">// 销毁容器</span></span>
<span class="line">    <span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Status                   <span class="token comment">// 获取当前状态</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-具体状态实现" tabindex="-1"><a class="header-anchor" href="#_2-2-具体状态实现"><span>2.2 具体状态实现</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// 已停止状态</span></span>
<span class="line"><span class="token keyword">type</span> stoppedState <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    c <span class="token operator">*</span>Container</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 已创建状态  </span></span>
<span class="line"><span class="token keyword">type</span> createdState <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    c <span class="token operator">*</span>Container</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 运行状态</span></span>
<span class="line"><span class="token keyword">type</span> runningState <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    c <span class="token operator">*</span>Container</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 暂停状态</span></span>
<span class="line"><span class="token keyword">type</span> pausedState <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    c <span class="token operator">*</span>Container</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-状态转换验证" tabindex="-1"><a class="header-anchor" href="#_2-3-状态转换验证"><span>2.3 状态转换验证</span></a></h3><p>每个状态都定义了允许的转换：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// createdState 的转换逻辑</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>createdState<span class="token punctuation">)</span> <span class="token function">transition</span><span class="token punctuation">(</span>s containerState<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> s<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token operator">*</span>runningState<span class="token punctuation">,</span> <span class="token operator">*</span>pausedState<span class="token punctuation">,</span> <span class="token operator">*</span>stoppedState<span class="token punctuation">:</span></span>
<span class="line">        i<span class="token punctuation">.</span>c<span class="token punctuation">.</span>state <span class="token operator">=</span> s  <span class="token comment">// 允许的转换</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token operator">*</span>createdState<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span>     <span class="token comment">// 保持当前状态</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">newStateTransitionError</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> s<span class="token punctuation">)</span>  <span class="token comment">// 非法转换</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-核心命令实现" tabindex="-1"><a class="header-anchor" href="#_3-核心命令实现"><span>3. 核心命令实现</span></a></h2><h3 id="_3-1-命令类型定义" tabindex="-1"><a class="header-anchor" href="#_3-1-命令类型定义"><span>3.1 命令类型定义</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// utils.go</span></span>
<span class="line"><span class="token keyword">type</span> CtAct <span class="token builtin">uint8</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">    CT_ACT_CREATE CtAct <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">// 创建容器</span></span>
<span class="line">    CT_ACT_RUN                      <span class="token comment">// 运行容器</span></span>
<span class="line">    CT_ACT_RESTORE                  <span class="token comment">// 从检查点恢复</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-runc-create-创建容器" tabindex="-1"><a class="header-anchor" href="#_3-2-runc-create-创建容器"><span>3.2 <code>runc create</code> - 创建容器</span></a></h3><h4 id="执行流程" tabindex="-1"><a class="header-anchor" href="#执行流程"><span>执行流程</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// create.go:35</span></span>
<span class="line"><span class="token keyword">var</span> createCommand <span class="token operator">=</span> cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></span>
<span class="line">    Name<span class="token punctuation">:</span>  <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Usage<span class="token punctuation">:</span> <span class="token string">&quot;create a container&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Action<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">checkArgs</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> exactArgs<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        spec<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">setupSpec</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">startContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> CT_ACT_CREATE<span class="token punctuation">,</span> spec<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="关键步骤分析" tabindex="-1"><a class="header-anchor" href="#关键步骤分析"><span>关键步骤分析</span></a></h4><ol><li><strong>参数验证</strong>: 确保提供了容器 ID</li><li><strong>配置加载</strong>: 读取和解析 <code>config.json</code></li><li><strong>容器创建</strong>: 调用 <code>startContainer()</code> 执行创建逻辑</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// utils.go:161 - startContainer 函数核心逻辑</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">startContainer</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> action CtAct<span class="token punctuation">,</span> spec <span class="token operator">*</span>specs<span class="token punctuation">.</span>Spec<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    id <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. 创建或加载容器</span></span>
<span class="line">    container<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> id<span class="token punctuation">,</span> spec<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 根据动作类型执行不同逻辑</span></span>
<span class="line">    <span class="token keyword">switch</span> action <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> CT_ACT_CREATE<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment">// 只创建，不启动</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">case</span> CT_ACT_RUN<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment">// 创建并运行</span></span>
<span class="line">        <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="create-命令的详细执行过程" tabindex="-1"><a class="header-anchor" href="#create-命令的详细执行过程"><span><code>create</code> 命令的详细执行过程</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">runc create mycontainer</span>
<span class="line">        │</span>
<span class="line">        ▼</span>
<span class="line">┌─────────────────────────────────────┐</span>
<span class="line">│ 1. CLI 解析和验证                   │</span>
<span class="line">│    - 检查参数数量                   │</span>
<span class="line">│    - 提取容器 ID                    │</span>
<span class="line">└─────────────┬───────────────────────┘</span>
<span class="line">              │</span>
<span class="line">              ▼</span>
<span class="line">┌─────────────────────────────────────┐</span>
<span class="line">│ 2. 配置加载 (setupSpec)             │</span>
<span class="line">│    - 读取 config.json               │</span>
<span class="line">│    - 验证 OCI 规范兼容性            │</span>
<span class="line">│    - 处理默认值                     │</span>
<span class="line">└─────────────┬───────────────────────┘</span>
<span class="line">              │</span>
<span class="line">              ▼</span>
<span class="line">┌─────────────────────────────────────┐</span>
<span class="line">│ 3. 容器创建 (createContainer)       │</span>
<span class="line">│    - OCI → libcontainer 配置转换    │</span>
<span class="line">│    - 创建 Container 对象            │</span>
<span class="line">│    - 设置状态目录                   │</span>
<span class="line">└─────────────┬───────────────────────┘</span>
<span class="line">              │</span>
<span class="line">              ▼</span>
<span class="line">┌─────────────────────────────────────┐</span>
<span class="line">│ 4. 进程准备 (container.Start)       │</span>
<span class="line">│    - 创建 namespace                 │</span>
<span class="line">│    - 设置 cgroups                   │</span>
<span class="line">│    - 初始化文件系统                  │</span>
<span class="line">│    - 启动初始化进程                  │</span>
<span class="line">│    - 状态: nil → Created            │</span>
<span class="line">└─────────────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-runc-start-启动容器" tabindex="-1"><a class="header-anchor" href="#_3-3-runc-start-启动容器"><span>3.3 <code>runc start</code> - 启动容器</span></a></h3><h4 id="执行流程-1" tabindex="-1"><a class="header-anchor" href="#执行流程-1"><span>执行流程</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// start.go:15</span></span>
<span class="line"><span class="token keyword">var</span> startCommand <span class="token operator">=</span> cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></span>
<span class="line">    Name<span class="token punctuation">:</span>  <span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Usage<span class="token punctuation">:</span> <span class="token string">&quot;executes the user defined process in a created container&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Action<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">        container<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        status<span class="token punctuation">,</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">switch</span> status <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> libcontainer<span class="token punctuation">.</span>Created<span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment">// 只有 Created 状态的容器可以被启动</span></span>
<span class="line">            <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">case</span> libcontainer<span class="token punctuation">.</span>Stopped<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;cannot start a container that has stopped&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">case</span> libcontainer<span class="token punctuation">.</span>Running<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;cannot start an already running container&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;cannot start a container in the %s state&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="关键特点" tabindex="-1"><a class="header-anchor" href="#关键特点"><span>关键特点</span></a></h4><ol><li><strong>状态检查</strong>: 只能启动 <code>Created</code> 状态的容器</li><li><strong>状态加载</strong>: 从磁盘加载容器状态</li><li><strong>进程启动</strong>: 使用 <code>container.Exec()</code> 启动初始化进程</li></ol><h4 id="exec-fifo-同步机制" tabindex="-1"><a class="header-anchor" href="#exec-fifo-同步机制"><span>Exec Fifo 同步机制</span></a></h4><p><code>runc start</code> 使用 <strong>exec fifo</strong> 机制来精确控制进程启动时机：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/container_linux.go:298</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    path <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>stateDir<span class="token punctuation">,</span> execFifoFilename<span class="token punctuation">)</span></span>
<span class="line">    blockingFifoOpenCh <span class="token operator">:=</span> <span class="token function">awaitFifoOpen</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> result <span class="token operator">:=</span> <span class="token operator">&lt;-</span>blockingFifoOpenCh<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">handleFifoResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment">// 定期检查进程是否仍然存活</span></span>
<span class="line">            stat<span class="token punctuation">,</span> err <span class="token operator">:=</span> system<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">||</span> stat<span class="token punctuation">.</span>State <span class="token operator">==</span> system<span class="token punctuation">.</span>Zombie <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;container process is already dead&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Exec Fifo 工作原理</strong>：</p><ol><li><code>runc create</code> 创建容器时，创建一个名为 <code>exec.fifo</code> 的文件</li><li>初始化进程等待有人打开这个 fifo 文件</li><li><code>runc start</code> 打开 fifo 文件，触发初始化进程开始执行</li><li>状态转换：<code>Created</code> → <code>Running</code></li></ol><h3 id="_3-4-runc-run-一步运行" tabindex="-1"><a class="header-anchor" href="#_3-4-runc-run-一步运行"><span>3.4 <code>runc run</code> - 一步运行</span></a></h3><h4 id="执行流程-2" tabindex="-1"><a class="header-anchor" href="#执行流程-2"><span>执行流程</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// run.go:28</span></span>
<span class="line"><span class="token keyword">var</span> runCommand <span class="token operator">=</span> cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></span>
<span class="line">    Name<span class="token punctuation">:</span>  <span class="token string">&quot;run&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Usage<span class="token punctuation">:</span> <span class="token string">&quot;create and run a container&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Action<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">        spec<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">setupSpec</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        status<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">startContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> CT_ACT_RUN<span class="token punctuation">,</span> spec<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 等待容器进程结束并返回退出状态</span></span>
<span class="line">            os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;runc run failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="与-create-start-的区别" tabindex="-1"><a class="header-anchor" href="#与-create-start-的区别"><span>与 <code>create</code> + <code>start</code> 的区别</span></a></h4><table><thead><tr><th>特性</th><th><code>runc run</code></th><th><code>runc create</code> + <code>runc start</code></th></tr></thead><tbody><tr><td>步骤数</td><td>一步完成</td><td>两步操作</td></tr><tr><td>状态转换</td><td>直接 <code>nil</code> → <code>Running</code></td><td><code>nil</code> → <code>Created</code> → <code>Running</code></td></tr><tr><td>使用场景</td><td>简单快速启动</td><td>需要在启动前进行配置</td></tr><tr><td>控制粒度</td><td>较粗</td><td>较细</td></tr></tbody></table><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// utils.go 中 CT_ACT_RUN 的处理</span></span>
<span class="line"><span class="token keyword">case</span> CT_ACT_RUN<span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment">// 直接运行，跳过 Created 状态</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        container<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 等待进程结束</span></span>
<span class="line">    status<span class="token punctuation">,</span> err <span class="token operator">:=</span> process<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> status<span class="token punctuation">,</span> err</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-runc-state-查询状态" tabindex="-1"><a class="header-anchor" href="#_3-5-runc-state-查询状态"><span>3.5 <code>runc state</code> - 查询状态</span></a></h3><h4 id="执行流程-3" tabindex="-1"><a class="header-anchor" href="#执行流程-3"><span>执行流程</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// state.go:15</span></span>
<span class="line"><span class="token keyword">var</span> stateCommand <span class="token operator">=</span> cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></span>
<span class="line">    Name<span class="token punctuation">:</span>  <span class="token string">&quot;state&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Usage<span class="token punctuation">:</span> <span class="token string">&quot;output the state of a container&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Action<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">        container<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 获取容器状态</span></span>
<span class="line">        containerStatus<span class="token punctuation">,</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        state<span class="token punctuation">,</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 构建输出格式</span></span>
<span class="line">        cs <span class="token operator">:=</span> containerState<span class="token punctuation">{</span></span>
<span class="line">            Version<span class="token punctuation">:</span>        state<span class="token punctuation">.</span>BaseState<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Version<span class="token punctuation">,</span></span>
<span class="line">            ID<span class="token punctuation">:</span>             state<span class="token punctuation">.</span>BaseState<span class="token punctuation">.</span>ID<span class="token punctuation">,</span></span>
<span class="line">            Status<span class="token punctuation">:</span>         containerStatus<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            Bundle<span class="token punctuation">:</span>         bundle<span class="token punctuation">,</span></span>
<span class="line">            Created<span class="token punctuation">:</span>        state<span class="token punctuation">.</span>BaseState<span class="token punctuation">.</span>Created<span class="token punctuation">,</span></span>
<span class="line">            InitProcessPid<span class="token punctuation">:</span> pid<span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">// ... 更多字段</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// JSON 格式输出</span></span>
<span class="line">        data<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;  &quot;</span><span class="token punctuation">)</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="输出示例" tabindex="-1"><a class="header-anchor" href="#输出示例"><span>输出示例</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ociVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mycontainer&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;running&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/tmp/mycontainer&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;rootfs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/tmp/mycontainer/rootfs&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-01-01T12:00:00.000000000Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;annotations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;mykey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myvalue&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-runc-delete-删除容器" tabindex="-1"><a class="header-anchor" href="#_3-6-runc-delete-删除容器"><span>3.6 <code>runc delete</code> - 删除容器</span></a></h3><h4 id="执行流程-4" tabindex="-1"><a class="header-anchor" href="#执行流程-4"><span>执行流程</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// delete.go:20</span></span>
<span class="line"><span class="token keyword">var</span> deleteCommand <span class="token operator">=</span> cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></span>
<span class="line">    Name<span class="token punctuation">:</span>  <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Usage<span class="token punctuation">:</span> <span class="token string">&quot;delete any resources held by the container often used with detached container&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    Flags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>cli<span class="token punctuation">.</span>Flag<span class="token punctuation">{</span></span>
<span class="line">        cli<span class="token punctuation">.</span>BoolFlag<span class="token punctuation">{</span></span>
<span class="line">            Name<span class="token punctuation">:</span>  <span class="token string">&quot;force, f&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            Usage<span class="token punctuation">:</span> <span class="token string">&quot;Forcibly deletes the container if it is still running (uses SIGKILL)&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    Action<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>context <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">        container<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getContainer</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 容器不存在，考虑已删除成功</span></span>
<span class="line">            <span class="token keyword">if</span> os<span class="token punctuation">.</span><span class="token function">IsNotExist</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        force <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token string">&quot;force&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> force <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">killContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        s<span class="token punctuation">,</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">switch</span> s <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> libcontainer<span class="token punctuation">.</span>Stopped<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 正常删除</span></span>
<span class="line">        <span class="token keyword">case</span> libcontainer<span class="token punctuation">.</span>Created<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">killContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>  <span class="token comment">// 强制删除</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;cannot delete container %s that is not stopped: %s&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> s<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="删除逻辑" tabindex="-1"><a class="header-anchor" href="#删除逻辑"><span>删除逻辑</span></a></h4><ol><li><strong>状态检查</strong>: 只能删除 <code>Stopped</code> 状态的容器</li><li><strong>强制删除</strong>: <code>--force</code> 标志可以删除任何状态的容器</li><li><strong>资源清理</strong>: 删除状态文件、清理 cgroups、清理 namespace</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// container.Destroy() 的清理步骤</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    c<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> c<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. 清理 cgroups</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>cgroupManager<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 删除状态目录</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>stateDir<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. 更新状态</span></span>
<span class="line">    c<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token operator">&amp;</span>stoppedState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-状态持久化机制" tabindex="-1"><a class="header-anchor" href="#_4-状态持久化机制"><span>4. 状态持久化机制</span></a></h2><h3 id="_4-1-状态存储结构" tabindex="-1"><a class="header-anchor" href="#_4-1-状态存储结构"><span>4.1 状态存储结构</span></a></h3><p>容器状态持久化在以下位置：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/run/runc/&lt;container-id&gt;/</span>
<span class="line">├── state.json          # 容器状态数据</span>
<span class="line">├── exec.fifo          # 启动同步机制</span>
<span class="line">└── hooks/             # 钩子函数相关文件</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-状态数据结构" tabindex="-1"><a class="header-anchor" href="#_4-2-状态数据结构"><span>4.2 状态数据结构</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/state.go</span></span>
<span class="line"><span class="token keyword">type</span> State <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    BaseState</span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// Linux 特定状态</span></span>
<span class="line">    Rootless       <span class="token builtin">bool</span>                              <span class="token string">`json:&quot;rootless&quot;`</span></span>
<span class="line">    CgroupPaths    <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>                 <span class="token string">`json:&quot;cgroup_paths&quot;`</span></span>
<span class="line">    NamespacePaths <span class="token keyword">map</span><span class="token punctuation">[</span>configs<span class="token punctuation">.</span>NamespaceType<span class="token punctuation">]</span><span class="token builtin">string</span>  <span class="token string">`json:&quot;namespace_paths&quot;`</span></span>
<span class="line">    ExternalDescriptors <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>                      <span class="token string">`json:&quot;external_descriptors&quot;`</span></span>
<span class="line">    IntelRdtPath   <span class="token builtin">string</span>                            <span class="token string">`json:&quot;intel_rdt_path&quot;`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> BaseState <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    ID                   <span class="token builtin">string</span>        <span class="token string">`json:&quot;id&quot;`</span></span>
<span class="line">    InitProcessPid       <span class="token builtin">int</span>           <span class="token string">`json:&quot;init_process_pid&quot;`</span>  </span>
<span class="line">    InitProcessStartTime <span class="token builtin">uint64</span>        <span class="token string">`json:&quot;init_process_start&quot;`</span></span>
<span class="line">    Created              time<span class="token punctuation">.</span>Time     <span class="token string">`json:&quot;created&quot;`</span></span>
<span class="line">    Config               configs<span class="token punctuation">.</span>Config <span class="token string">`json:&quot;config&quot;`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-状态加载过程" tabindex="-1"><a class="header-anchor" href="#_4-3-状态加载过程"><span>4.3 状态加载过程</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/factory_linux.go:190</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Load</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Container<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    stateDir<span class="token punctuation">,</span> err <span class="token operator">:=</span> securejoin<span class="token punctuation">.</span><span class="token function">SecureJoin</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. 从 state.json 加载状态</span></span>
<span class="line">    state<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadState</span><span class="token punctuation">(</span>stateDir<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 重建容器对象</span></span>
<span class="line">    container <span class="token operator">:=</span> <span class="token operator">&amp;</span>Container<span class="token punctuation">{</span></span>
<span class="line">        initProcess<span class="token punctuation">:</span>          nonChildProcess<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        initProcessStartTime<span class="token punctuation">:</span> state<span class="token punctuation">.</span>InitProcessStartTime<span class="token punctuation">,</span></span>
<span class="line">        id<span class="token punctuation">:</span>                   id<span class="token punctuation">,</span></span>
<span class="line">        config<span class="token punctuation">:</span>               <span class="token operator">&amp;</span>state<span class="token punctuation">.</span>Config<span class="token punctuation">,</span></span>
<span class="line">        stateDir<span class="token punctuation">:</span>             stateDir<span class="token punctuation">,</span></span>
<span class="line">        created<span class="token punctuation">:</span>              state<span class="token punctuation">.</span>Created<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. 刷新运行时状态</span></span>
<span class="line">    container<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token operator">&amp;</span>loadedState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> container<span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> container<span class="token punctuation">.</span><span class="token function">refreshState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> container<span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-状态同步机制" tabindex="-1"><a class="header-anchor" href="#_4-4-状态同步机制"><span>4.4 状态同步机制</span></a></h3><p><code>refreshState()</code> 方法负责将磁盘状态与实际运行时状态同步：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/container_linux.go:156</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">refreshState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 检查是否被暂停</span></span>
<span class="line">    paused<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> paused <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> c<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pausedState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 检查初始化进程是否存在</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span>c<span class="token punctuation">.</span><span class="token function">hasInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> c<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stoppedState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. 检查是否处于 Created 状态</span></span>
<span class="line">    <span class="token comment">// 通过检查 exec.fifo 文件是否存在来判断</span></span>
<span class="line">    fifoPath <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>stateDir<span class="token punctuation">,</span> execFifoFilename<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>fifoPath<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> c<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>createdState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 4. 默认为 Running 状态</span></span>
<span class="line">    <span class="token keyword">return</span> c<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>runningState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-进程管理与同步" tabindex="-1"><a class="header-anchor" href="#_5-进程管理与同步"><span>5. 进程管理与同步</span></a></h2><h3 id="_5-1-初始化进程模型" tabindex="-1"><a class="header-anchor" href="#_5-1-初始化进程模型"><span>5.1 初始化进程模型</span></a></h3><p>runc 使用分层的进程模型来管理容器：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌─────────────────┐</span>
<span class="line">│   runc 主进程   │  ← 用户调用的 runc 命令</span>
<span class="line">└─────────┬───────┘</span>
<span class="line">          │ fork()</span>
<span class="line">          ▼</span>
<span class="line">┌─────────────────┐</span>
<span class="line">│  bootstrap 进程 │  ← 负责 namespace 设置和初始化</span>
<span class="line">└─────────┬───────┘</span>
<span class="line">          │ exec()</span>
<span class="line">          ▼</span>
<span class="line">┌─────────────────┐</span>
<span class="line">│  container 进程 │  ← 最终的用户进程</span>
<span class="line">└─────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-进程接口定义" tabindex="-1"><a class="header-anchor" href="#_5-2-进程接口定义"><span>5.2 进程接口定义</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/process.go:52</span></span>
<span class="line"><span class="token keyword">type</span> parentProcess <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">pid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>                           <span class="token comment">// 获取进程 PID</span></span>
<span class="line">    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>                       <span class="token comment">// 启动进程</span></span>
<span class="line">    <span class="token function">signal</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Signal<span class="token punctuation">)</span> <span class="token builtin">error</span>             <span class="token comment">// 发送信号</span></span>
<span class="line">    <span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>                   <span class="token comment">// 终止进程</span></span>
<span class="line">    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>os<span class="token punctuation">.</span>ProcessState<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>    <span class="token comment">// 等待进程结束</span></span>
<span class="line">    <span class="token function">startTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">uint64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>         <span class="token comment">// 获取启动时间</span></span>
<span class="line">    <span class="token function">externalDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>      <span class="token comment">// 外部文件描述符</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-进程创建流程" tabindex="-1"><a class="header-anchor" href="#_5-3-进程创建流程"><span>5.3 进程创建流程</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/container_linux.go:485</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span>process <span class="token operator">*</span>Process<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    c<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> c<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. 状态检查</span></span>
<span class="line">    <span class="token keyword">if</span> c<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Cgroups <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Cgroups<span class="token punctuation">.</span>Resources <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 验证 cgroups 配置</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 创建父进程</span></span>
<span class="line">    parent<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">newParentProcess</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. 启动进程</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> parent<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 4. 保存进程信息</span></span>
<span class="line">    c<span class="token punctuation">.</span>initProcess <span class="token operator">=</span> parent</span>
<span class="line">    c<span class="token punctuation">.</span>initProcessStartTime<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">startTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 5. 状态转换</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>createdState<span class="token punctuation">{</span>c<span class="token punctuation">:</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-同步机制" tabindex="-1"><a class="header-anchor" href="#_5-4-同步机制"><span>5.4 同步机制</span></a></h3><h4 id="exec-fifo-详解" tabindex="-1"><a class="header-anchor" href="#exec-fifo-详解"><span>Exec Fifo 详解</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// libcontainer/utils.go:45</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">awaitFifoOpen</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> openResult <span class="token punctuation">{</span></span>
<span class="line">    fifoOpened <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> openResult<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>fifoOpened<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 创建 fifo 文件</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">Mkfifo</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token number">0622</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>os<span class="token punctuation">.</span><span class="token function">IsExist</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            fifoOpened <span class="token operator">&lt;-</span> openResult<span class="token punctuation">{</span>err<span class="token punctuation">:</span> err<span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 等待另一端打开 fifo</span></span>
<span class="line">        fd<span class="token punctuation">,</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> unix<span class="token punctuation">.</span>O_RDONLY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            fifoOpened <span class="token operator">&lt;-</span> openResult<span class="token punctuation">{</span>err<span class="token punctuation">:</span> err<span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        fifoOpened <span class="token operator">&lt;-</span> openResult<span class="token punctuation">{</span>file<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">NewFile</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> fifoOpened</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>工作流程</strong>：</p><ol><li><strong>创建阶段</strong> (<code>runc create</code>): 创建 <code>exec.fifo</code> 文件，初始化进程等待</li><li><strong>启动阶段</strong> (<code>runc start</code>): 打开 <code>exec.fifo</code> 文件，释放等待的初始化进程</li><li><strong>清理阶段</strong>: 删除 <code>exec.fifo</code> 文件，状态转换到 <code>Running</code></li></ol><h2 id="_6-实践练习" tabindex="-1"><a class="header-anchor" href="#_6-实践练习"><span>6. 实践练习</span></a></h2><h3 id="_6-1-状态转换实验" tabindex="-1"><a class="header-anchor" href="#_6-1-状态转换实验"><span>6.1 状态转换实验</span></a></h3><p>创建一个容器并观察状态变化：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 1. 准备容器环境</span></span>
<span class="line"><span class="token function">mkdir</span> /tmp/container-lifecycle</span>
<span class="line"><span class="token builtin class-name">cd</span> /tmp/container-lifecycle</span>
<span class="line"><span class="token function">mkdir</span> rootfs</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 准备根文件系统</span></span>
<span class="line"><span class="token function">docker</span> <span class="token builtin class-name">export</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> create busybox<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">tar</span> <span class="token parameter variable">-C</span> rootfs <span class="token parameter variable">-xf</span> -</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 生成配置文件</span></span>
<span class="line">runc spec</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 观察状态转换</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;=== 创建容器 ===&quot;</span></span>
<span class="line">runc create test-container</span>
<span class="line">runc state test-container</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;=== 启动容器 ===&quot;</span></span>
<span class="line">runc start test-container <span class="token operator">&amp;</span></span>
<span class="line"><span class="token function">sleep</span> <span class="token number">1</span></span>
<span class="line">runc state test-container</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;=== 暂停容器 ===&quot;</span></span>
<span class="line">runc pause test-container</span>
<span class="line">runc state test-container</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;=== 恢复容器 ===&quot;</span></span>
<span class="line">runc resume test-container</span>
<span class="line">runc state test-container</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;=== 删除容器 ===&quot;</span></span>
<span class="line">runc <span class="token function">kill</span> test-container</span>
<span class="line">runc delete test-container</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-代码跟踪练习" tabindex="-1"><a class="header-anchor" href="#_6-2-代码跟踪练习"><span>6.2 代码跟踪练习</span></a></h3><p>在关键位置添加日志来跟踪状态转换：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// 在 libcontainer/state_linux.go 中添加日志</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>createdState<span class="token punctuation">)</span> <span class="token function">transition</span><span class="token punctuation">(</span>s containerState<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG: Transitioning from &#39;created&#39; to &#39;%T&#39;\n&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">switch</span> s<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token operator">*</span>runningState<span class="token punctuation">:</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG: Container starting execution\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        i<span class="token punctuation">.</span>c<span class="token punctuation">.</span>state <span class="token operator">=</span> s</span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line">    <span class="token comment">// ... 其他状态</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">newStateTransitionError</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> s<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-exec-fifo-实验" tabindex="-1"><a class="header-anchor" href="#_6-3-exec-fifo-实验"><span>6.3 Exec Fifo 实验</span></a></h3><p>观察 exec fifo 的创建和使用：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 终端 1: 创建容器并监控 fifo</span></span>
<span class="line">runc create test-container</span>
<span class="line"><span class="token function">ls</span> <span class="token parameter variable">-la</span> /run/runc/test-container/</span>
<span class="line"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">0.1</span> <span class="token string">&quot;ls -la /run/runc/test-container/ | grep fifo&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 终端 2: 启动容器</span></span>
<span class="line">runc start test-container</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 观察 exec.fifo 文件的创建和删除</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-深入思考" tabindex="-1"><a class="header-anchor" href="#_7-深入思考"><span>7. 深入思考</span></a></h2><h3 id="_7-1-设计问题" tabindex="-1"><a class="header-anchor" href="#_7-1-设计问题"><span>7.1 设计问题</span></a></h3><ol><li><p><strong>为什么需要 Created 状态？</strong></p><ul><li>允许在实际执行前进行额外配置</li><li>支持复杂的启动编排</li><li>符合 OCI 规范要求</li></ul></li><li><p><strong>Exec Fifo 的作用是什么？</strong></p><ul><li>精确控制进程启动时机</li><li>避免竞态条件</li><li>支持同步和异步操作模式</li></ul></li><li><p><strong>状态持久化的必要性？</strong></p><ul><li>跨进程状态共享</li><li>故障恢复能力</li><li>支持容器管理工具集成</li></ul></li></ol><h3 id="_7-2-性能考虑" tabindex="-1"><a class="header-anchor" href="#_7-2-性能考虑"><span>7.2 性能考虑</span></a></h3><ol><li><strong>状态检查的开销</strong>: 频繁的状态查询可能影响性能</li><li><strong>进程同步成本</strong>: Fifo 机制增加了启动延迟</li><li><strong>持久化 I/O</strong>: 状态文件的读写操作</li></ol><h3 id="_7-3-错误处理" tabindex="-1"><a class="header-anchor" href="#_7-3-错误处理"><span>7.3 错误处理</span></a></h3><ol><li><strong>状态不一致</strong>: 如何处理磁盘状态与实际状态不符？</li><li><strong>进程清理</strong>: 异常情况下如何确保资源清理？</li><li><strong>并发控制</strong>: 多个 runc 进程同时操作同一容器？</li></ol><h2 id="_8-扩展阅读" tabindex="-1"><a class="header-anchor" href="#_8-扩展阅读"><span>8. 扩展阅读</span></a></h2><ul><li><a href="https://github.com/opencontainers/runtime-spec/blob/main/runtime.md#lifecycle" target="_blank" rel="noopener noreferrer">OCI Runtime Specification - Container Lifecycle<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://man7.org/linux/man-pages/man5/proc.5.html" target="_blank" rel="noopener noreferrer">Linux Process State Management<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/" target="_blank" rel="noopener noreferrer">Container State in Kubernetes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="🎯-模块总结" tabindex="-1"><a class="header-anchor" href="#🎯-模块总结"><span>🎯 模块总结</span></a></h2><p>通过本模块的学习，你应该已经掌握了：</p><p>✅ 容器的四种基本状态和转换规则<br> ✅ runc 核心命令的实现原理和执行流程<br> ✅ 状态持久化和同步机制<br> ✅ 进程管理和 Exec Fifo 同步机制<br> ✅ 容器生命周期管理的设计模式</p><p><strong>下一步</strong>: 进入 <a class="route-link" href="/blog/blogs/cloud-base/runc-deep-dive/03-Namespacegelishixian.html">模块 3: Namespace 隔离实现</a>，深入了解容器隔离的核心技术。</p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->更新于 8/12/2025, 4:02:36 PM<!--]--></span></span></div></footer><!----><div class="reco-valine-wrapper"><div id="valine"></div></div></div><div class="page-catalog-container"><h5 class="tip">目录</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#概述" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="概述"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->概述<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#容器状态模型" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="容器状态模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->容器状态模型<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_1-1-四种基本状态" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.1 四种基本状态"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.1 四种基本状态<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_1-2-状态详细说明" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.2 状态详细说明"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.2 状态详细说明<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_1-3-状态转换图" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.3 状态转换图"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.3 状态转换图<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_2-状态管理实现" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 状态管理实现"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 状态管理实现<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_2-1-状态机接口" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.1 状态机接口"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.1 状态机接口<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_2-2-具体状态实现" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.2 具体状态实现"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.2 具体状态实现<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_2-3-状态转换验证" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.3 状态转换验证"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.3 状态转换验证<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-核心命令实现" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3. 核心命令实现"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3. 核心命令实现<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-1-命令类型定义" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.1 命令类型定义"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.1 命令类型定义<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-2-runc-create-创建容器" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.2 runc create - 创建容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.2 runc create - 创建容器<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-3-runc-start-启动容器" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.3 runc start - 启动容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.3 runc start - 启动容器<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-4-runc-run-一步运行" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.4 runc run - 一步运行"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.4 runc run - 一步运行<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-5-runc-state-查询状态" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.5 runc state - 查询状态"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.5 runc state - 查询状态<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_3-6-runc-delete-删除容器" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.6 runc delete - 删除容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.6 runc delete - 删除容器<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_4-状态持久化机制" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4. 状态持久化机制"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4. 状态持久化机制<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_4-1-状态存储结构" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.1 状态存储结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.1 状态存储结构<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_4-2-状态数据结构" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.2 状态数据结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.2 状态数据结构<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_4-3-状态加载过程" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.3 状态加载过程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.3 状态加载过程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_4-4-状态同步机制" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.4 状态同步机制"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.4 状态同步机制<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_5-进程管理与同步" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5. 进程管理与同步"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5. 进程管理与同步<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_5-1-初始化进程模型" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.1 初始化进程模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.1 初始化进程模型<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_5-2-进程接口定义" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.2 进程接口定义"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.2 进程接口定义<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_5-3-进程创建流程" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.3 进程创建流程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.3 进程创建流程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_5-4-同步机制" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.4 同步机制"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.4 同步机制<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_6-实践练习" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6. 实践练习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6. 实践练习<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_6-1-状态转换实验" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.1 状态转换实验"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.1 状态转换实验<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_6-2-代码跟踪练习" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.2 代码跟踪练习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.2 代码跟踪练习<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_6-3-exec-fifo-实验" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.3 Exec Fifo 实验"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.3 Exec Fifo 实验<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_7-深入思考" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="7. 深入思考"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->7. 深入思考<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_7-1-设计问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="7.1 设计问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->7.1 设计问题<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_7-2-性能考虑" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="7.2 性能考虑"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->7.2 性能考虑<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_7-3-错误处理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="7.3 错误处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->7.3 错误处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#_8-扩展阅读" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="8. 扩展阅读"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->8. 扩展阅读<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/cloud-base/runc-deep-dive/02-rongqishengmingzhouqiguanli.html#🎯-模块总结" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="🎯 模块总结"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->🎯 模块总结<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-6X7aTgdN.js" defer></script>
  </body>
</html>
